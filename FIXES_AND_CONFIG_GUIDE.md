# 🔧 问题修复和配置指南

## ✅ 已修复的问题

### 1. 音效无声音 🔇 → 🔊
**原因**: 浏览器安全策略要求用户交互后才能播放音频

**解决方案**:
- ✅ 添加了启动屏幕
- ✅ 用户点击"开始游戏"后启用音效
- ✅ 符合浏览器安全要求

### 2. 没有设置页面 ❌ → ⚙️
**解决方案**:
- ✅ 创建了完整的配置面板
- ✅ 支持音效、动画、AI、TTS配置
- ✅ 配置自动保存到localStorage

### 3. 无法配置Ollama ❌ → ✅
**解决方案**:
- ✅ 在设置面板中添加Ollama配置
- ✅ 可以设置LLM端点和模型
- ✅ 配置实时生效

---

## 🎮 使用指南

### 启动游戏
1. 打开浏览器访问：`http://localhost:3000/index-pure.html`
2. 看到启动屏幕，点击"开始游戏"按钮
3. 音效和游戏开始运行

### 打开设置
有3种方式打开设置面板：

1. **点击右上角⚙️按钮**
2. **按ESC键**
3. **控制台输入** `showConfig()`

### 设置选项

#### 🔊 音效设置
- **启用音效**: 勾选/取消音效
- **音量**: 拖动滑块调整音量（0-100%）

#### ✨ 动画设置
- **启用动画**: 勾选/取消发牌、出牌动画

#### 🤖 AI设置（Ollama）
- **启用LLM智能决策**: 使用Ollama增强AI
- **Ollama地址**: 默认 `http://localhost:11434/api/chat`
- **模型名称**: 默认 `qwen2.5:3b`

**使用前提**:
1. 确保Ollama已安装
2. 启动Ollama服务：`ollama serve`
3. 下载模型：`ollama pull qwen2.5:3b`

#### 🗣️ 语音设置（TTS）
- **启用语音播报**: AI出牌时语音播报
- **语音提供商**:
  - `浏览器内置`: 最简单，无需配置
  - `Edge TTS`: 微软Edge语音（需配置）
  - `Piper TTS`: 开源TTS（需配置）
  - `Ollama TTS`: 使用Ollama（需配置）

---

## 🔍 问题排查

### 问题1: 音效还是没声音

**检查步骤**:
1. ✅ 确认点击了"开始游戏"按钮
2. ✅ 打开设置，确认"启用音效"已勾选
3. ✅ 检查音量滑块不是0
4. ✅ 检查浏览器没有静音
5. ✅ 打开浏览器控制台，查看是否有错误

**浏览器控制台应该显示**:
```
[SoundSystem] AudioContext已创建
[SoundSystem] 开始预加载音效...
[SoundSystem] ✓ play-small
[SoundSystem] ✓ play-medium
...
```

### 问题2: 聊天没显示

**检查步骤**:
1. ✅ 打开浏览器控制台
2. ✅ 查找 `[ChatSystem]` 相关日志
3. ✅ 确认AI出牌后有 `sendMessage` 日志

**应该看到**:
```
[ChatSystem] 已初始化
[ChatSystem] 玩家1(AI-激进): 我出牌了！
[DOMRenderer] AI-激进: 我出牌了！
```

### 问题3: Ollama不工作

**检查步骤**:
1. ✅ 确认Ollama服务运行中
   ```bash
   # 检查Ollama是否运行
   curl http://localhost:11434/api/tags
   ```

2. ✅ 确认模型已下载
   ```bash
   ollama list
   # 应该看到 qwen2.5:3b
   ```

3. ✅ 打开设置，启用"LLM智能决策"

4. ✅ 检查控制台日志
   ```
   [MasterAIBrain] Ollama已启用
   [MasterAIBrain] 请求LLM决策...
   ```

### 问题4: TTS不说话

**浏览器内置TTS**:
1. ✅ 打开设置，启用"语音播报"
2. ✅ 选择"浏览器内置"
3. ✅ 浏览器会请求语音权限，点击"允许"

**其他TTS提供商**:
- 需要额外配置和服务
- 建议先使用"浏览器内置"测试

---

## 📊 配置文件

配置自动保存在浏览器的 `localStorage` 中：

**查看当前配置**:
```javascript
// 在浏览器控制台输入
configPanel.getConfig()
```

**手动修改配置**:
```javascript
// 清除配置（恢复默认）
localStorage.removeItem('game-config')

// 然后刷新页面
```

---

## 🎯 推荐配置

### 快速游戏（默认）
```
✅ 音效: 启用，音量70%
✅ 动画: 启用
❌ LLM: 禁用（MCTS已经足够好）
❌ TTS: 禁用（聊天文字足够）
```

### 完整体验
```
✅ 音效: 启用，音量70%
✅ 动画: 启用
✅ LLM: 启用（需要Ollama）
✅ TTS: 启用，浏览器内置
```

### 性能优先
```
✅ 音效: 启用，音量50%
❌ 动画: 禁用（提升性能）
❌ LLM: 禁用
❌ TTS: 禁用
```

---

## 🔧 开发者工具

### 浏览器控制台命令

```javascript
// 显示游戏引擎
gameEngine

// 显示配置面板
showConfig()

// 打印当前状态
printState()

// 导出训练数据
exportData()

// 查看配置
configPanel.getConfig()

// 查看音效统计
gameEngine.soundSystem.getStatistics()

// 查看聊天统计
gameEngine.chatSystem.getStatistics()
```

---

## 📝 常见问题 FAQ

### Q1: 为什么需要点击"开始游戏"？
**A**: 浏览器安全策略要求用户交互后才能播放音频。这是所有网页游戏的标准做法。

### Q2: Ollama一定要配置吗？
**A**: 不需要。默认的MCTS算法已经足够智能。Ollama是可选的增强功能。

### Q3: 配置会丢失吗？
**A**: 不会。配置保存在浏览器localStorage中，除非清除浏览器数据。

### Q4: 可以关闭音效吗？
**A**: 可以。打开设置，取消勾选"启用音效"。

### Q5: 动画影响性能吗？
**A**: 影响很小。我们使用CSS动画（GPU加速），性能优秀。

---

## 🚀 下一步

### 立即测试
1. 刷新页面
2. 点击"开始游戏"
3. 听音效、看动画
4. 按ESC打开设置
5. 试试各种配置

### 如果还有问题
1. 打开浏览器控制台（F12）
2. 查看错误日志
3. 截图发送给我

---

**祝游戏愉快！** 🎮🎵🗨️

*更新时间: 2025-12-04*

