# ChatGPT è®¨è®ºæ€»ç»“ - AI åµæ¶ç‹æ£‹ç‰Œæ¸¸æˆæ¶æ„

## ğŸ“‹ è®¨è®ºèƒŒæ™¯

æœ¬æ¬¡è®¨è®ºå›´ç»•å¦‚ä½•åœ¨æµè§ˆå™¨ï¼ˆReactï¼‰ä¸­å®ç°ä¸€ä¸ª"åµæ¶ç‹"æ£‹ç‰Œæ¸¸æˆï¼Œæ”¯æŒï¼š
- å¤šä¸ªAIç©å®¶åŒæ—¶è¯´è¯ï¼ˆé€»è¾‘å¤šé€šé“ï¼‰
- å¤šè¯­è¨€æ”¯æŒï¼ˆä¸­æ–‡ã€æ—¥ã€éŸ©ã€è‹±ç­‰ï¼‰
- å—æ˜Œè¯æ”¯æŒï¼ˆæ–‡æœ¬+è¯­éŸ³ï¼‰
- é•¿æ®µåµæ¶ï¼ˆåŒ…é¾™æ˜Ÿå¼ï¼‰
- æ–‡æ˜ç­‰çº§æ§åˆ¶ï¼ˆç²—å£å¯†åº¦ï¼‰

## ğŸ¯ æ ¸å¿ƒç»“è®º

### 1. å¤šå£°é“å®ç°æ–¹å¼

**ä¸æ˜¯ç‰©ç†å¤šå£°é“ï¼ˆ5.1/7.1ï¼‰**ï¼Œè€Œæ˜¯**é€»è¾‘å¤šé€šé“ï¼ˆå¤šè·¯åŒæ—¶å‘å£°ï¼‰**ï¼š

- âœ… æµè§ˆå™¨å®Œå…¨å¯ä»¥å®ç°
- âœ… ä½¿ç”¨"å…ˆç”ŸæˆéŸ³é¢‘ â†’ WebAudio å¹¶å‘æ··éŸ³"
- âœ… æ¯ä¸ªAIä¸€æ®µéŸ³é¢‘ï¼Œç”¨ `AudioBufferSourceNode` åŒæ—¶ `start()`
- âœ… æ”¯æŒduckingã€æŠ¢è¯ã€å·¦å³å£°åƒåˆ†ç¦»

### 2. ä¸ä½¿ç”¨ speechSynthesis

**åŸå› **ï¼š
- `speechSynthesis` æ˜¯å•é€šé“é˜Ÿåˆ—ï¼Œä¼šè®©AIæ’é˜Ÿ
- æ— æ³•å®ç°çœŸæ­£çš„å¤šå£°é“å¹¶å‘æ’­æ”¾

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¿…é¡»å…ˆç”ŸæˆéŸ³é¢‘æ–‡ä»¶ï¼ˆArrayBuffer/AudioBufferï¼‰
- ç„¶åé€šè¿‡Web Audio APIæ’­æ”¾
- ä½¿ç”¨æœ¬åœ°TTSæœåŠ¡ï¼ˆGPT-SoVITSã€Coqui TTSã€Edge TTSç­‰ï¼‰

### 3. é•¿åµæ¶åˆ†æ®µæ’­æ”¾

**å…³é”®**ï¼šé•¿åµæ¶ä¸èƒ½ä¸€æ¬¡ç”Ÿæˆ40ç§’éŸ³é¢‘

**æ­£ç¡®åšæ³•**ï¼š
- æ¨¡å‹è¾“å‡º"èŠ‚æ‹/åˆ†å¥"ï¼ˆbeatsï¼‰
- æ¯1-2å¥å°±TTSæˆä¸€æ®µ1-3ç§’éŸ³é¢‘
- è¾¹ç”Ÿæˆè¾¹æ’­æ”¾ï¼ˆæµå¼ï¼‰
- æ”¯æŒæŠ¢è¯/æ’å˜´

### 4. å¤šè¯­è¨€ç­–ç•¥

**ä¼˜å…ˆé¡ºåº**ï¼š
1. è®©Qwenç›´æ¥è¾“å‡ºç›®æ ‡è¯­è¨€çŸ­å¥ï¼ˆå¼ºçº¦æŸã€å£è¯­ã€çŸ­å¥ï¼‰
2. è‹¥æ—¥/éŸ©æ•ˆæœä¸ä½³ â†’ ç”¨æœ¬åœ°è½»é‡ç¿»è¯‘å™¨ï¼ˆArgos/OPUS-MTï¼‰åš zhâ†’ja / zhâ†’ko

**å—æ˜Œè¯**ï¼š
- å…ˆè§„åˆ™/è¯è¡¨æ”¹å†™ï¼ˆå¿«é€Ÿè½åœ°ï¼‰
- å†LoRAè®­ç»ƒ"å—æ˜Œè¯æ”¹å†™å™¨"ï¼ˆå¢å¼ºåœ°é“åº¦ï¼‰

### 5. 8äººæˆ¿é—´è¯­éŸ³è°ƒåº¦

**è®¾è®¡ç›®æ ‡**ï¼š
- æˆ¿é—´æœ€å¤š8äºº
- åŒæ—¶å‘å£°æœ€å¤š2äººï¼ˆmaxConcurrent=2ï¼‰
- å…¶ä»–äººåªèƒ½çŸ­æ’ä¸€å¥ï¼ˆQUICK_JAB â‰¤ 1.5sï¼‰

**å…³é”®ç»„ä»¶**ï¼š
- `DialogueScheduler`ï¼šå¯¹è¯è°ƒåº¦å™¨ï¼ˆåˆ†å¥/æŠ¢è¯/å¹¶å‘ä¸Šé™ï¼‰
- `AudioMixer`ï¼šå¤šè§’è‰² gain + ducking + å£°åƒ

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ€»ä½“æµæ°´çº¿

```
æ¸¸æˆäº‹ä»¶è§¦å‘
  â†“
Qwenç”Ÿæˆä¸­æ–‡æ„å›¾å°è¯
  â†“
æ–‡æœ¬åˆ†æµä¸æ”¹å†™ï¼ˆå¤šè¯­è¨€ + å—æ˜Œè¯ï¼‰
  â†“
TTSåˆæˆéŸ³é¢‘ï¼ˆæ¯ä¸ªAIä¸€æ®µï¼‰
  â†“
WebAudioå¹¶å‘æ··éŸ³æ’­æ”¾
```

### å…³é”®ç»„ä»¶

1. **DialogueScheduler** (`src/audio/DialogueScheduler.ts`)
   - ç®¡ç†å¤šä¸ªAIçš„è¯­éŸ³æ’­æ”¾
   - å®ç°"åµæ¶ç‹å¯¹è½°"æ•ˆæœ
   - ä¼˜å…ˆçº§ï¼šMAIN_FIGHT > QUICK_JAB > NORMAL_CHAT

2. **AudioMixer** (`src/services/ttsAudioService.ts`)
   - WebAudioæ··éŸ³å™¨
   - æ¯ä¸ªè§’è‰²ä¸€ä¸ª roleGainNode + StereoPanner
   - æ”¯æŒduckingï¼ˆé™ä½å…¶ä»–è§’è‰²éŸ³é‡ï¼‰

3. **BeatsGenerator** (`src/ai/beatsGenerator.ts`)
   - é•¿åµæ¶èŠ‚æ‹ç”Ÿæˆ
   - åˆ†æ®µå‡ºå¥è¾¹æ’­

4. **å—æ˜Œè¯æ”¹å†™å™¨** (`src/ai/dialect/nanchang_rules.ts`)
   - è§„åˆ™/è¯è¡¨æ”¹å†™
   - LoRAè®­ç»ƒæ•°æ®ç”Ÿæˆ

## ğŸ“ å®ç°è¦ç‚¹

### 1. éŸ³é¢‘è¿æ¥å›¾

```
source (AudioBufferSourceNode)
  â†“
segGain (GainNode - å•ä¸ªéŸ³é¢‘æ®µçš„éŸ³é‡æ§åˆ¶)
  â†“
roleGain (GainNode - è§’è‰²çš„åŸºç¡€éŸ³é‡)
  â†“
panner (StereoPannerNode - å£°åƒå®šä½)
  â†“
masterGain (GainNode - ä¸»éŸ³é‡æ§åˆ¶)
  â†“
destination (AudioContext.destination)
```

### 2. Duckingæœºåˆ¶

```typescript
function duckOthers(activeRoleId: string, otherLevel=0.25) {
  for (const [id, role] of roleNodes) {
    const target = id === activeRoleId ? 1.0 : otherLevel;
    role.gain.gain.setTargetAtTime(target, audioCtx.currentTime, 0.05);
  }
}
```

### 3. æ¨èå‚æ•°

- `maxConcurrent = 2`ï¼ˆæœ€å¤š2äººåŒæ—¶è¯´è¯ï¼‰
- `otherLevel = 0.2 ~ 0.35`ï¼ˆduckingæ—¶å…¶ä»–è§’è‰²éŸ³é‡ï¼‰
- ä¸»åµæ¶å·¦å³å£°åƒï¼š`pan=-0.35` / `+0.35`
- å…¶ä»–äººéšæœºåˆ†å¸ƒ `[-0.6, 0.6]`

### 4. æ–‡æ˜ç­‰çº§ï¼ˆcivility_levelï¼‰

- **0**ï¼šæ–‡æ˜ï¼ˆæ— ç²—å£ï¼‰
- **1**ï¼šè½»å¾®è®½åˆº
- **2**ï¼šå…è®¸å£å¤´ç²—è¯ï¼ˆéä¾®è¾±æ€§ï¼‰
- **3**ï¼šå¼ºçƒˆç²—å£ï¼ˆä»ç¦æ­¢æ­§è§†/ä»‡æ¨ï¼‰
- **4**ï¼šæé™æµ‹è¯•æ¡£ï¼ˆä»ç¦ä»‡æ¨/ç¾¤ä½“æ”»å‡»ï¼‰

## ğŸš€ å®ç°é¡ºåº

### Phase 1ï¼šå…ˆè·‘é€šå¹¶å‘åµæ¶ âœ…
- Qwenç”Ÿæˆä¸­æ–‡çŸ­å¥
- TTSåˆæˆçŸ­éŸ³é¢‘ï¼ˆæ™®é€šè¯å ä½ï¼‰
- WebAudioå¹¶å‘æ’­æ”¾
- maxConcurrent=2 + ducking

### Phase 2ï¼šé•¿åµæ¶èŠ‚æ‹åŒ– â³
- beatsç”Ÿæˆ
- åˆ†æ®µå‡ºå¥è¾¹æ’­
- æ’å˜´ QUICK_JAB

### Phase 3ï¼šå—æ˜Œè¯ä¸Šçº¿ â³
- è§„åˆ™/è¯è¡¨æ”¹å†™
- å½•ç´ æ â†’ GPT-SoVITS å—æ˜Œå£°çº¿
- å—æ˜Œè¯æ–‡æœ¬ + å—æ˜Œ voice ç»„åˆ

### Phase 4ï¼šå¤šè¯­è¨€æ‰©å±• â³
- ç›®æ ‡è¯­ç›´å‡ºçŸ­å¥
- ä¸è‡ªç„¶åˆ™æ¥æœ¬åœ°è½»é‡ç¿»è¯‘
- åŠ å¯¹åº”è¯­è¨€ TTS å£°çº¿

### Phase 5ï¼šåµæ¶ç‹è®­ç»ƒ â³
- 300~500æ¡é«˜è´¨é‡äº’æ€¼æ ·æœ¬ï¼ˆå«civilityï¼‰
- QLoRA SFTå­¦é£æ ¼
- DPOåå¥½ä¼˜åŒ–å­¦èŠ‚å¥

## ğŸ“ æ–‡ä»¶ç»“æ„

```
/src
  /ai
    qwenClient.ts
    prompt/
      style_packlongxing.md  # åµæ¶ç‹é£æ ¼ system+æ¨¡æ¿
      beats_template.md
    dialect/
      nanchang_rules.ts      # å—æ˜Œè¯è§„åˆ™/è¯è¡¨æ”¹å†™
      nanchang_lora.md
    translate/
      argosClient.ts
  /tts
    ttsClient.ts
    speakers.ts
  /audio
    AudioMixer.ts            # å·²é›†æˆåœ¨ ttsAudioService.ts
    DialogueScheduler.ts     # âœ… å·²å­˜åœ¨
    useAudioRoom.ts
  /game
    events.ts
    aiController.ts
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [AIåµæ¶ç‹æ¶æ„æ–‡æ¡£](./ai-quarrel-king-architecture.md) - å®Œæ•´æ¶æ„è®¾è®¡
- [å¤šå£°é“éŸ³é¢‘å®ç°è¯´æ˜](./multi-channel-audio-implementation.md) - æŠ€æœ¯å®ç°ç»†èŠ‚
- [AudioMixerè®¾è®¡æ–‡æ¡£](./audio-mixer-design.md) - AudioMixerè¯¦ç»†è¯´æ˜

---

**æœ€åæ›´æ–°**ï¼š2025-01-25  
**æ¥æº**ï¼šä¸ ChatGPT çš„è¯¦ç»†è®¨è®º  
**çŠ¶æ€**ï¼šè®¾è®¡æ–‡æ¡£ï¼Œéƒ¨åˆ†å·²å®ç°

