# 多语言框架重构 - 设计总结

## 📋 快速概览

本文档是多语言框架重构设计的快速参考，详细设计请参考其他文档。

## 🎯 核心目标

1. **独立性**: 多语言系统作为独立模块
2. **自动化**: 新增组件时自动生成多语言配置
3. **扩展性**: 轻松添加新语言、新组件
4. **类型安全**: 完整的 TypeScript 类型支持

## 🏗️ 架构概览

```
组件层
  ↓
i18n Framework Core (翻译管理器、资源加载器、类型生成器)
  ↓
i18n Resources (按组件组织的翻译文件)
  ↓
Build Tools (扫描、生成、验证、类型生成工具)
```

## 📁 目录结构

```
src/i18n/                    # 框架核心
├── core/                    # 核心功能
├── hooks/                   # React Hooks
├── utils/                   # 工具函数
└── types/                   # 类型定义

i18n-resources/              # 翻译资源（独立）
├── components/              # 组件级翻译
├── features/                # 功能级翻译
└── shared/                  # 共享翻译

scripts/i18n/                # 构建工具
├── scan.ts                 # 扫描工具
├── generate.ts             # 生成工具
├── validate.ts             # 验证工具
└── types.ts                # 类型生成
```

## 🔑 核心特性

### 1. 组件级翻译系统
- 每个组件拥有独立的翻译文件
- 自动生成翻译文件模板
- 支持组件级命名空间

### 2. 自动化工具链
- **扫描工具**: 自动提取需要翻译的文本
- **生成工具**: 自动生成翻译文件
- **验证工具**: 检查翻译完整性
- **类型生成**: 自动生成 TypeScript 类型

### 3. 类型安全
- 编译时类型检查
- IDE 自动补全
- 翻译键类型安全

### 4. 开发体验
- CLI 工具简化操作
- Vite Plugin 自动检查
- 清晰的错误提示

## 🚀 使用流程

### 新增组件时

```bash
# 1. 创建组件（使用翻译）
const { t } = useComponentTranslation('NewComponent');

# 2. 扫描组件
npm run i18n:scan --component NewComponent

# 3. 生成翻译文件
npm run i18n:generate --component NewComponent

# 4. 填写翻译内容
# 编辑生成的 JSON 文件

# 5. 类型自动更新
npm run i18n:types
```

### 添加新语言时

```bash
# 1. 更新配置
# 在 config.ts 中添加新语言

# 2. 生成翻译文件
npm run i18n:generate --language fr-FR

# 3. 填写翻译内容
# 编辑生成的 JSON 文件
```

### 验证翻译

```bash
# 验证所有翻译
npm run i18n:validate

# 输出报告
✓ 所有语言翻译完整
✗ 发现 3 个缺失翻译
✗ 发现 2 个未使用的键
```

## 📊 关键决策

| 决策项 | 选择 | 理由 |
|--------|------|------|
| 命名空间 | 组件级 | 模块化、易维护 |
| 文件组织 | 按组件 | 组件完整、易于管理 |
| 类型生成 | 编译时 | 类型安全、IDE 支持 |
| 加载策略 | 混合 | 性能平衡 |
| 向后兼容 | 完全兼容 | 平滑迁移 |

## ⏱️ 实施时间表

- **阶段一**: 框架核心 (2天)
- **阶段二**: 工具开发 (3天)
- **阶段三**: 类型系统 (1天)
- **阶段四**: 迁移 (2天)
- **阶段五**: 测试优化 (1-2天)

**总计**: 8-10 天

## 📚 相关文档

1. **[设计文档](./i18n-framework-design.md)**: 详细的架构和功能设计
2. **[实施计划](./i18n-framework-implementation-plan.md)**: 详细的实施步骤
3. **[技术决策](./i18n-framework-technical-decisions.md)**: 关键技术选择

## ❓ 常见问题

### Q: 如何保证向后兼容？
A: 提供适配层，保留旧的 API，逐步迁移。

### Q: 性能影响如何？
A: 使用懒加载和缓存，性能影响最小。

### Q: 如何添加新语言？
A: 运行生成工具，自动创建所有翻译文件模板。

### Q: 类型系统如何工作？
A: 构建时从翻译文件生成类型定义，提供编译时检查。

### Q: 工具如何集成？
A: 通过 NPM Scripts 和 Vite Plugin，开发时自动检查。

## 🎯 下一步

1. 评审设计文档
2. 确认技术方案
3. 开始实施
4. 根据反馈调整

