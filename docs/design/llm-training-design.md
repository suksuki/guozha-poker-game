# LLMå‚ä¸è®­ç»ƒå’ŒèŠå¤©è®­ç»ƒè®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•

1. [LLMå‚ä¸æ‰“ç‰Œç®—æ³•è®­ç»ƒ](#llmå‚ä¸æ‰“ç‰Œç®—æ³•è®­ç»ƒ)
2. [èŠå¤©è®­ç»ƒæ–¹æ¡ˆ](#èŠå¤©è®­ç»ƒæ–¹æ¡ˆ)
3. [æ··åˆè®­ç»ƒç­–ç•¥](#æ··åˆè®­ç»ƒç­–ç•¥)
4. [å®ç°æ¶æ„](#å®ç°æ¶æ„)

---

## ğŸ§  LLMå‚ä¸æ‰“ç‰Œç®—æ³•è®­ç»ƒ

### ä¸€ã€LLMåœ¨æ‰“ç‰Œè®­ç»ƒä¸­çš„è§’è‰²

LLMåœ¨æ‰“ç‰Œç®—æ³•è®­ç»ƒä¸­å¯ä»¥æ‰®æ¼”å¤šä¸ªè§’è‰²ï¼š

#### 1. **ç­–ç•¥åˆ†æå™¨ (Strategy Analyzer)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LLMç­–ç•¥åˆ†æ                        â”‚
â”‚                                      â”‚
â”‚  è¾“å…¥ï¼šæ¸¸æˆçŠ¶æ€ + MCTSå†³ç­–           â”‚
â”‚  è¾“å‡ºï¼šç­–ç•¥å»ºè®® + è§£é‡Š               â”‚
â”‚                                      â”‚
â”‚  åŠŸèƒ½ï¼š                              â”‚
â”‚  - åˆ†æå½“å‰å±€é¢                      â”‚
â”‚  - è¯„ä¼°MCTSå†³ç­–çš„åˆç†æ€§              â”‚
â”‚  - æä¾›æˆ˜ç•¥å±‚é¢çš„å»ºè®®                â”‚
â”‚  - è¯†åˆ«æ½œåœ¨é£é™©/æœºä¼š                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. **å†³ç­–è´¨é‡è¯„ä¼°å™¨ (Decision Quality Evaluator)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LLMå†³ç­–è¯„ä¼°                        â”‚
â”‚                                      â”‚
â”‚  è¾“å…¥ï¼šæ¸¸æˆçŠ¶æ€ + å†³ç­– + ç»“æœ        â”‚
â”‚  è¾“å‡ºï¼šè´¨é‡è¯„åˆ† + æ”¹è¿›å»ºè®®            â”‚
â”‚                                      â”‚
â”‚  åŠŸèƒ½ï¼š                              â”‚
â”‚  - è¯„ä¼°å†³ç­–è´¨é‡ï¼ˆ0-1åˆ†ï¼‰             â”‚
â”‚  - è¯†åˆ«å†³ç­–ä¸­çš„é—®é¢˜                  â”‚
â”‚  - æä¾›æ”¹è¿›æ–¹å‘                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. **MCTSå‚æ•°ä¼˜åŒ–å»ºè®®å™¨ (Parameter Optimizer)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LLMå‚æ•°ä¼˜åŒ–                        â”‚
â”‚                                      â”‚
â”‚  è¾“å…¥ï¼šè®­ç»ƒæ•°æ® + æ€§èƒ½æŒ‡æ ‡            â”‚
â”‚  è¾“å‡ºï¼šå‚æ•°è°ƒæ•´å»ºè®®                  â”‚
â”‚                                      â”‚
â”‚  åŠŸèƒ½ï¼š                              â”‚
â”‚  - åˆ†æMCTSå‚æ•°å¯¹æ€§èƒ½çš„å½±å“          â”‚
â”‚  - å»ºè®®æœ€ä¼˜å‚æ•°ç»„åˆ                  â”‚
â”‚  - è§£é‡Šå‚æ•°è°ƒæ•´çš„åŸå›                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äºŒã€LLMå‚ä¸è®­ç»ƒçš„å…·ä½“æ–¹å¼

#### æ–¹å¼1ï¼šLLMè¾…åŠ©MCTSè®­ç»ƒï¼ˆæ¨èï¼‰

**è®­ç»ƒæµç¨‹ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. MCTSè‡ªå¯¹å¼ˆç”Ÿæˆå†³ç­–                  â”‚
â”‚     â†“                                    â”‚
â”‚  2. LLMåˆ†æå†³ç­–è´¨é‡                     â”‚
â”‚     - è¯„ä¼°å†³ç­–åˆç†æ€§                     â”‚
â”‚     - è¯†åˆ«æ½œåœ¨é—®é¢˜                       â”‚
â”‚     - æä¾›æ”¹è¿›å»ºè®®                       â”‚
â”‚     â†“                                    â”‚
â”‚  3. æ ¹æ®LLMåé¦ˆè°ƒæ•´MCTSå‚æ•°             â”‚
â”‚     - å¦‚æœLLMè®¤ä¸ºå†³ç­–å·®ï¼Œå¢åŠ æ¢ç´¢        â”‚
â”‚     - å¦‚æœLLMè®¤ä¸ºå†³ç­–å¥½ï¼Œä¿æŒå‚æ•°        â”‚
â”‚     â†“                                    â”‚
â”‚  4. ç»§ç»­è®­ç»ƒï¼Œæ”¶é›†æ›´å¤šæ•°æ®              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°ç¤ºä¾‹ï¼š**
```typescript
interface LLMAssistedTraining {
  // 1. MCTSåšå‡ºå†³ç­–
  mctsDecision: Card[];
  
  // 2. LLMè¯„ä¼°å†³ç­–
  llmEvaluation: {
    quality: number;        // 0-1åˆ†
    reasoning: string;      // è§£é‡Š
    suggestions: string[];  // æ”¹è¿›å»ºè®®
    riskFactors: string[];  // é£é™©å› ç´ 
  };
  
  // 3. æ ¹æ®è¯„ä¼°è°ƒæ•´MCTSå‚æ•°
  mctsParams: {
    explorationConstant: number;  // æ ¹æ®LLMåé¦ˆè°ƒæ•´
    iterations: number;            // æ ¹æ®å¤æ‚åº¦è°ƒæ•´
  };
  
  // 4. æ¸¸æˆç»“æœéªŒè¯
  gameOutcome: {
    won: boolean;
    score: number;
    finalRank: number;
  };
}
```

#### æ–¹å¼2ï¼šLLMç”Ÿæˆè®­ç»ƒæ ·æœ¬æ ‡ç­¾

**æµç¨‹ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. æ”¶é›†æœªæ ‡æ³¨çš„è®­ç»ƒæ•°æ®                â”‚
â”‚     - æ¸¸æˆçŠ¶æ€                          â”‚
â”‚     - MCTSå†³ç­–                          â”‚
â”‚     - æ¸¸æˆç»“æœ                          â”‚
â”‚     â†“                                    â”‚
â”‚  2. LLMæ‰¹é‡æ ‡æ³¨æ•°æ®                     â”‚
â”‚     - åˆ¤æ–­å†³ç­–è´¨é‡ï¼ˆå¥½/ä¸­/å·®ï¼‰          â”‚
â”‚     - æ ‡æ³¨å…³é”®ç‰¹å¾                      â”‚
â”‚     - ç”Ÿæˆè®­ç»ƒæ ‡ç­¾                      â”‚
â”‚     â†“                                    â”‚
â”‚  3. ä½¿ç”¨æ ‡æ³¨æ•°æ®è®­ç»ƒMCTSå‚æ•°            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ–¹å¼3ï¼šLLMæŒ‡å¯¼MCTSæœç´¢æ–¹å‘

**æµç¨‹ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. LLMåˆ†æå½“å‰å±€é¢                     â”‚
â”‚     - è¯†åˆ«å…³é”®ç‰Œå‹                      â”‚
â”‚     - è¯„ä¼°æ‰‹ç‰Œå¼ºåº¦                      â”‚
â”‚     - å»ºè®®æˆ˜ç•¥æ–¹å‘                      â”‚
â”‚     â†“                                    â”‚
â”‚  2. MCTSæ ¹æ®LLMå»ºè®®ä¼˜åŒ–æœç´¢            â”‚
â”‚     - ä¼˜å…ˆæ¢ç´¢LLMå»ºè®®çš„æ–¹å‘              â”‚
â”‚     - è°ƒæ•´æ¢ç´¢å¸¸æ•°                      â”‚
â”‚     - èšç„¦å…³é”®å†³ç­–ç‚¹                    â”‚
â”‚     â†“                                    â”‚
â”‚  3. ç”Ÿæˆæ›´é«˜è´¨é‡çš„å†³ç­–                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‰ã€LLM Promptè®¾è®¡

#### Prompt 1ï¼šå†³ç­–è´¨é‡è¯„ä¼°
```typescript
const decisionEvaluationPrompt = `
ä½ æ˜¯ä¸€ä¸ªè¿‡ç‚¸ç‰Œæ¸¸æˆä¸“å®¶ï¼Œéœ€è¦è¯„ä¼°AIç©å®¶çš„å†³ç­–è´¨é‡ã€‚

## æ¸¸æˆçŠ¶æ€
- å½“å‰æ‰‹ç‰Œï¼š${hand}
- ä¸Šå®¶å‡ºç‰Œï¼š${lastPlay}
- å½“å‰è½®æ¬¡ï¼š${round}
- å½“å‰å¾—åˆ†ï¼š${scores}
- ç©å®¶æ•°é‡ï¼š${playerCount}

## AIå†³ç­–
- å‡ºç‰Œï¼š${decision}
- å†³ç­–ç†ç”±ï¼š${reasoning}

## ä»»åŠ¡
è¯·è¯„ä¼°è¿™ä¸ªå†³ç­–çš„è´¨é‡ï¼Œå¹¶ç»™å‡ºï¼š
1. è´¨é‡è¯„åˆ†ï¼ˆ0-1åˆ†ï¼Œ1åˆ†æœ€å¥½ï¼‰
2. å†³ç­–åˆç†æ€§åˆ†æ
3. æ½œåœ¨é£é™©/æœºä¼š
4. æ”¹è¿›å»ºè®®ï¼ˆå¦‚æœæœ‰ï¼‰

è¯·ç”¨JSONæ ¼å¼è¿”å›ï¼š
{
  "quality": 0.85,
  "reasoning": "è¿™ä¸ªå†³ç­–...",
  "risks": ["é£é™©1", "é£é™©2"],
  "opportunities": ["æœºä¼š1"],
  "suggestions": ["å»ºè®®1", "å»ºè®®2"]
}
`;
```

#### Prompt 2ï¼šç­–ç•¥åˆ†æ
```typescript
const strategyAnalysisPrompt = `
ä½ æ˜¯ä¸€ä¸ªè¿‡ç‚¸ç‰Œæ¸¸æˆç­–ç•¥åˆ†æå¸ˆã€‚

## å½“å‰å±€é¢
${gameState}

## MCTSåˆ†æç»“æœ
- æ¨èåŠ¨ä½œï¼š${mctsAction}
- ç½®ä¿¡åº¦ï¼š${confidence}
- å¤‡é€‰æ–¹æ¡ˆï¼š${alternatives}

## ä»»åŠ¡
è¯·ä»æˆ˜ç•¥å±‚é¢åˆ†æï¼š
1. å½“å‰å±€é¢çš„å…³é”®ç‰¹å¾
2. MCTSå†³ç­–æ˜¯å¦ç¬¦åˆæˆ˜ç•¥ç›®æ ‡
3. æ˜¯å¦æœ‰æ›´å¥½çš„æˆ˜ç•¥é€‰æ‹©
4. é•¿æœŸå½±å“è¯„ä¼°

è¯·ç”¨JSONæ ¼å¼è¿”å›åˆ†æç»“æœã€‚
`;
```

#### Prompt 3ï¼šå‚æ•°ä¼˜åŒ–å»ºè®®
```typescript
const parameterOptimizationPrompt = `
ä½ æ˜¯ä¸€ä¸ªç®—æ³•ä¼˜åŒ–ä¸“å®¶ã€‚

## è®­ç»ƒæ•°æ®ç»Ÿè®¡
- æ€»å¯¹å±€æ•°ï¼š${totalGames}
- å¹³å‡èƒœç‡ï¼š${winRate}
- å†³ç­–è´¨é‡ï¼š${avgQuality}
- å½“å‰å‚æ•°ï¼š
  - explorationConstant: ${currentExploration}
  - iterations: ${currentIterations}

## æ€§èƒ½è¶‹åŠ¿
${performanceTrend}

## ä»»åŠ¡
è¯·åˆ†æå‚æ•°å¯¹æ€§èƒ½çš„å½±å“ï¼Œå¹¶ç»™å‡ºä¼˜åŒ–å»ºè®®ï¼š
1. å“ªäº›å‚æ•°éœ€è¦è°ƒæ•´
2. è°ƒæ•´æ–¹å‘å’Œå¹…åº¦
3. é¢„æœŸæ•ˆæœ

è¯·ç”¨JSONæ ¼å¼è¿”å›ã€‚
`;
```

---

## ğŸ’¬ èŠå¤©è®­ç»ƒæ–¹æ¡ˆ

### ä¸€ã€èŠå¤©è®­ç»ƒçš„ç›®æ ‡

1. **æå‡èŠå¤©è´¨é‡**
   - ç›¸å…³æ€§ï¼šèŠå¤©å†…å®¹æ˜¯å¦è´´åˆæ¸¸æˆåœºæ™¯
   - è¶£å‘³æ€§ï¼šèŠå¤©æ˜¯å¦æœ‰è¶£ã€ç”ŸåŠ¨
   - å¤šæ ·æ€§ï¼šé¿å…é‡å¤ã€åƒç¯‡ä¸€å¾‹
   - åˆé€‚æ€§ï¼šèŠå¤©æ—¶æœºå’Œå†…å®¹æ˜¯å¦åˆé€‚

2. **ä¼˜åŒ–Promptæ¨¡æ¿**
   - æ‰¾åˆ°æœ€ä¼˜çš„System Prompt
   - ä¼˜åŒ–Promptç»“æ„
   - è°ƒæ•´å‚æ•°ï¼ˆtemperature, maxTokensç­‰ï¼‰

3. **è®­ç»ƒèŠå¤©ç”Ÿæˆæ¨¡å‹**ï¼ˆå¦‚æœæ”¯æŒå¾®è°ƒï¼‰
   - æ”¶é›†é«˜è´¨é‡èŠå¤©æ•°æ®
   - å¾®è°ƒLLMæ¨¡å‹
   - æˆ–è®­ç»ƒèŠå¤©è´¨é‡è¯„ä¼°æ¨¡å‹

### äºŒã€èŠå¤©è®­ç»ƒæµç¨‹

#### é˜¶æ®µ1ï¼šæ•°æ®æ”¶é›†
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¿«é€Ÿæ¸¸æˆå¯¹å±€ï¼ˆ1000å±€ï¼‰                â”‚
â”‚  â†“                                      â”‚
â”‚  æ”¶é›†æ‰€æœ‰èŠå¤©æ¶ˆæ¯ï¼š                     â”‚
â”‚  - æ¶ˆæ¯å†…å®¹                             â”‚
â”‚  - è§¦å‘åœºæ™¯                             â”‚
â”‚  - æ¸¸æˆçŠ¶æ€                             â”‚
â”‚  - LLM Prompt                           â”‚
â”‚  - LLMåŸå§‹å“åº”                          â”‚
â”‚  - ç©å®¶æ€§æ ¼                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®æ ¼å¼ï¼š**
```typescript
interface ChatTrainingSample {
  // è¾“å…¥
  gameState: {
    hand: Card[];
    lastPlay: Play | null;
    scores: number[];
    round: number;
    phase: 'early' | 'mid' | 'late' | 'critical';
  };
  
  trigger: 'after_decision' | 'after_play' | 'game_event' | 'idle';
  
  player: {
    id: number;
    personality: PersonalityConfig;
    dialect?: string;
  };
  
  // LLMè¾“å…¥
  prompt: {
    systemPrompt: string;
    userPrompt: string;
    fullPrompt: string;
  };
  
  // LLMè¾“å‡º
  llmResponse: {
    raw: string;           // åŸå§‹å“åº”
    processed: string;     // å¤„ç†åå†…å®¹
    tokens: number;
    latency: number;
  };
  
  // æ ‡ç­¾ï¼ˆéœ€è¦äººå·¥æˆ–è‡ªåŠ¨æ ‡æ³¨ï¼‰
  labels: {
    quality: number;      // 0-1åˆ†
    relevance: number;    // ç›¸å…³æ€§ 0-1
    diversity: number;     // å¤šæ ·æ€§ 0-1
    engagement: number;   // è¶£å‘³æ€§ 0-1
    appropriateness: number; // åˆé€‚æ€§ 0-1
  };
  
  // å…ƒæ•°æ®
  metadata: {
    timestamp: number;
    trainingRound: number;
    modelVersion: string;
  };
}
```

#### é˜¶æ®µ2ï¼šè´¨é‡è¯„ä¼°

**A. è‡ªåŠ¨è¯„ä¼°ï¼ˆåŸºäºè§„åˆ™ï¼‰**
```typescript
function autoEvaluateChat(message: ChatTrainingSample): ChatQualityMetrics {
  return {
    // ç›¸å…³æ€§ï¼šæ£€æŸ¥æ˜¯å¦åŒ…å«æ¸¸æˆå…³é”®è¯
    relevance: calculateRelevance(message),
    
    // å¤šæ ·æ€§ï¼šæ£€æŸ¥ä¸å†å²æ¶ˆæ¯çš„ç›¸ä¼¼åº¦
    diversity: calculateDiversity(message, history),
    
    // é•¿åº¦åˆé€‚æ€§
    lengthAppropriateness: message.llmResponse.processed.length >= 5 && 
                           message.llmResponse.processed.length <= 20 ? 1 : 0.5,
    
    // æ— å†—ä½™è¡¨è¾¾
    noRedundancy: !hasRedundantPhrases(message.llmResponse.processed) ? 1 : 0.5,
    
    // ç»¼åˆåˆ†æ•°
    overall: calculateOverall(...)
  };
}
```

**B. LLMè¾…åŠ©è¯„ä¼°**
```typescript
const chatQualityEvaluationPrompt = `
è¯„ä¼°ä»¥ä¸‹èŠå¤©æ¶ˆæ¯çš„è´¨é‡ï¼š

## æ¸¸æˆåœºæ™¯
${gameState}

## èŠå¤©æ¶ˆæ¯
"${chatMessage}"

## ä»»åŠ¡
è¯·ä»ä»¥ä¸‹ç»´åº¦è¯„ä¼°ï¼ˆ0-1åˆ†ï¼‰ï¼š
1. ç›¸å…³æ€§ï¼šæ˜¯å¦è´´åˆæ¸¸æˆåœºæ™¯
2. è¶£å‘³æ€§ï¼šæ˜¯å¦æœ‰è¶£ã€ç”ŸåŠ¨
3. åˆé€‚æ€§ï¼šæ—¶æœºå’Œå†…å®¹æ˜¯å¦åˆé€‚
4. å¤šæ ·æ€§ï¼šæ˜¯å¦æ–°é¢–ã€ä¸é‡å¤

è¯·ç”¨JSONæ ¼å¼è¿”å›ï¼š
{
  "relevance": 0.9,
  "engagement": 0.8,
  "appropriateness": 0.85,
  "diversity": 0.7,
  "overall": 0.81,
  "reasoning": "è¿™ä¸ªèŠå¤©..."
}
`;
```

#### é˜¶æ®µ3ï¼šPromptä¼˜åŒ–è®­ç»ƒ

**A. Prompt A/Bæµ‹è¯•**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. å‡†å¤‡å¤šä¸ªPromptå˜ä½“                  â”‚
â”‚     - Prompt Aï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰               â”‚
â”‚     - Prompt Bï¼ˆä¼˜åŒ–ç‰ˆæœ¬1ï¼‰             â”‚
â”‚     - Prompt Cï¼ˆä¼˜åŒ–ç‰ˆæœ¬2ï¼‰             â”‚
â”‚     â†“                                    â”‚
â”‚  2. åœ¨ç›¸åŒåœºæ™¯ä¸‹æµ‹è¯•ä¸åŒPrompt          â”‚
â”‚     - ä½¿ç”¨ç›¸åŒçš„æ¸¸æˆçŠ¶æ€                â”‚
â”‚     - ç”Ÿæˆå¤šä¸ªèŠå¤©æ¶ˆæ¯                  â”‚
â”‚     â†“                                    â”‚
â”‚  3. è¯„ä¼°æ¯ä¸ªPromptçš„è´¨é‡                â”‚
â”‚     - è®¡ç®—å¹³å‡è´¨é‡åˆ†æ•°                  â”‚
â”‚     - ç»Ÿè®¡å¤šæ ·æ€§                        â”‚
â”‚     â†“                                    â”‚
â”‚  4. é€‰æ‹©æœ€ä¼˜Prompt                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**B. Promptå‚æ•°ä¼˜åŒ–**
```typescript
interface PromptOptimization {
  // æµ‹è¯•ä¸åŒçš„System Prompt
  systemPrompts: string[];
  
  // æµ‹è¯•ä¸åŒçš„å‚æ•°
  parameters: {
    temperature: number[];    // [0.7, 0.8, 0.9, 1.0]
    maxTokens: number[];      // [30, 50, 100]
  };
  
  // è¯„ä¼°æŒ‡æ ‡
  metrics: {
    avgQuality: number;
    diversity: number;
    latency: number;
  };
}
```

#### é˜¶æ®µ4ï¼šæ¨¡å‹å¾®è°ƒï¼ˆå¯é€‰ï¼‰

å¦‚æœLLMæ”¯æŒå¾®è°ƒï¼ˆå¦‚Ollamaæ”¯æŒLoRAï¼‰ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. å‡†å¤‡é«˜è´¨é‡è®­ç»ƒæ•°æ®                  â”‚
â”‚     - ç­›é€‰è´¨é‡åˆ†æ•° > 0.8çš„æ ·æœ¬         â”‚
â”‚     - äººå·¥å®¡æ ¸å’Œæ ‡æ³¨                    â”‚
â”‚     â†“                                    â”‚
â”‚  2. æ„å»ºè®­ç»ƒæ•°æ®é›†                      â”‚
â”‚     - æ ¼å¼åŒ–ä¸ºæ¨¡å‹è®­ç»ƒæ ¼å¼              â”‚
â”‚     - åˆ’åˆ†è®­ç»ƒ/éªŒè¯é›†                   â”‚
â”‚     â†“                                    â”‚
â”‚  3. å¾®è°ƒæ¨¡å‹                            â”‚
â”‚     - ä½¿ç”¨LoRAç­‰è½»é‡çº§å¾®è°ƒæ–¹æ³•          â”‚
â”‚     - è®­ç»ƒèŠå¤©ç”Ÿæˆèƒ½åŠ›                  â”‚
â”‚     â†“                                    â”‚
â”‚  4. è¯„ä¼°å¾®è°ƒæ•ˆæœ                        â”‚
â”‚     - å¯¹æ¯”å¾®è°ƒå‰åçš„è´¨é‡                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‰ã€èŠå¤©è®­ç»ƒçš„å…·ä½“å®ç°

#### 1. èŠå¤©æ•°æ®æ”¶é›†å™¨
```typescript
class ChatDataCollector {
  private samples: ChatTrainingSample[] = [];
  
  // æ”¶é›†èŠå¤©æ¶ˆæ¯
  collectChatMessage(
    gameState: GameState,
    trigger: string,
    player: AIPlayer,
    prompt: string,
    llmResponse: string,
    processedContent: string
  ): void {
    const sample: ChatTrainingSample = {
      gameState,
      trigger,
      player: {
        id: player.id,
        personality: player.getPersonality(),
        dialect: player.getDialect()
      },
      prompt: {
        systemPrompt: this.getSystemPrompt(),
        userPrompt: this.getUserPrompt(gameState, trigger),
        fullPrompt: prompt
      },
      llmResponse: {
        raw: llmResponse,
        processed: processedContent,
        tokens: this.estimateTokens(llmResponse),
        latency: this.getLatency()
      },
      labels: {
        quality: 0,  // å¾…è¯„ä¼°
        relevance: 0,
        diversity: 0,
        engagement: 0,
        appropriateness: 0
      },
      metadata: {
        timestamp: Date.now(),
        trainingRound: this.currentRound,
        modelVersion: this.modelVersion
      }
    };
    
    this.samples.push(sample);
  }
  
  // æ‰¹é‡è¯„ä¼°è´¨é‡
  async evaluateQuality(): Promise<void> {
    for (const sample of this.samples) {
      // è‡ªåŠ¨è¯„ä¼°
      const autoMetrics = this.autoEvaluate(sample);
      
      // LLMè¾…åŠ©è¯„ä¼°ï¼ˆå¯é€‰ï¼‰
      const llmMetrics = await this.llmEvaluate(sample);
      
      // ç»¼åˆè¯„ä¼°
      sample.labels = this.combineMetrics(autoMetrics, llmMetrics);
    }
  }
}
```

#### 2. Promptä¼˜åŒ–å™¨
```typescript
class PromptOptimizer {
  private variants: PromptVariant[] = [];
  
  // æµ‹è¯•Promptå˜ä½“
  async testPromptVariants(
    basePrompt: string,
    variants: string[]
  ): Promise<PromptTestResult[]> {
    const results: PromptTestResult[] = [];
    
    for (const variant of variants) {
      // åœ¨ç›¸åŒåœºæ™¯ä¸‹æµ‹è¯•
      const testSamples = await this.generateTestSamples(variant);
      
      // è¯„ä¼°è´¨é‡
      const metrics = await this.evaluateSamples(testSamples);
      
      results.push({
        prompt: variant,
        metrics,
        samples: testSamples
      });
    }
    
    return results;
  }
  
  // é€‰æ‹©æœ€ä¼˜Prompt
  selectBestPrompt(results: PromptTestResult[]): string {
    // æŒ‰ç»¼åˆåˆ†æ•°æ’åº
    results.sort((a, b) => 
      b.metrics.overall - a.metrics.overall
    );
    
    return results[0].prompt;
  }
}
```

#### 3. èŠå¤©è®­ç»ƒå™¨
```typescript
class ChatTrainer {
  private collector: ChatDataCollector;
  private optimizer: PromptOptimizer;
  
  // å¼€å§‹è®­ç»ƒ
  async startTraining(config: ChatTrainingConfig): Promise<void> {
    // 1. å¿«é€Ÿæ¸¸æˆæ”¶é›†æ•°æ®
    const samples = await this.collectTrainingData(config.rounds);
    
    // 2. è¯„ä¼°æ•°æ®è´¨é‡
    await this.collector.evaluateQuality();
    
    // 3. ç­›é€‰é«˜è´¨é‡æ ·æœ¬
    const highQualitySamples = this.filterHighQuality(samples, 0.8);
    
    // 4. Promptä¼˜åŒ–
    const bestPrompt = await this.optimizePrompt(highQualitySamples);
    
    // 5. æ›´æ–°é…ç½®
    this.updateChatConfig(bestPrompt);
    
    // 6. è¯„ä¼°è®­ç»ƒæ•ˆæœ
    const improvement = await this.evaluateImprovement();
    
    console.log(`è®­ç»ƒå®Œæˆï¼Œè´¨é‡æå‡ï¼š${improvement}%`);
  }
}
```

---

## ğŸ”„ æ··åˆè®­ç»ƒç­–ç•¥

### MCTS + LLM ååŒè®­ç»ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ··åˆè®­ç»ƒå¾ªç¯                            â”‚
â”‚                                          â”‚
â”‚  1. MCTSè‡ªå¯¹å¼ˆç”Ÿæˆå†³ç­–                  â”‚
â”‚     â†“                                    â”‚
â”‚  2. LLMè¯„ä¼°å†³ç­–è´¨é‡                     â”‚
â”‚     â†“                                    â”‚
â”‚  3. æ ¹æ®è¯„ä¼°è°ƒæ•´MCTSå‚æ•°                â”‚
â”‚     â†“                                    â”‚
â”‚  4. LLMç”ŸæˆèŠå¤©ï¼ˆåŸºäºMCTSå†³ç­–ï¼‰         â”‚
â”‚     â†“                                    â”‚
â”‚  5. è¯„ä¼°èŠå¤©è´¨é‡                        â”‚
â”‚     â†“                                    â”‚
â”‚  6. ä¼˜åŒ–èŠå¤©Prompt                      â”‚
â”‚     â†“                                    â”‚
â”‚  7. è¯„ä¼°æ•´ä½“æ•ˆæœï¼Œç»§ç»­ä¸‹ä¸€è½®             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®­ç»ƒæ•°æ®å…±äº«

```typescript
interface HybridTrainingData {
  // æ‰“ç‰Œå†³ç­–æ•°æ®
  decision: {
    gameState: GameState;
    mctsDecision: Card[];
    llmEvaluation: LLMEvaluation;
    gameOutcome: GameOutcome;
  };
  
  // èŠå¤©æ•°æ®
  chat: {
    gameState: GameState;
    decision: Card[];
    chatMessage: string;
    chatQuality: ChatQualityMetrics;
  };
  
  // å…³è”æ€§
  correlation: {
    // å†³ç­–è´¨é‡ä¸èŠå¤©è´¨é‡çš„ç›¸å…³æ€§
    decisionChatCorrelation: number;
    
    // èŠå¤©æ˜¯å¦å‡†ç¡®åæ˜ äº†å†³ç­–æ„å›¾
    chatDecisionAlignment: number;
  };
}
```

---

## ğŸ—ï¸ å®ç°æ¶æ„

### ç›®å½•ç»“æ„
```
src/
â”œâ”€â”€ training/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ TrainingController.ts      # è®­ç»ƒæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ TrainingExecutor.ts        # è®­ç»ƒæ‰§è¡Œå™¨
â”‚   â”‚   â””â”€â”€ TrainingDataManager.ts     # æ•°æ®ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ decision/
â”‚   â”‚   â”œâ”€â”€ MCTSTrainer.ts             # MCTSè®­ç»ƒå™¨
â”‚   â”‚   â”œâ”€â”€ LLMDecisionEvaluator.ts    # LLMå†³ç­–è¯„ä¼°å™¨
â”‚   â”‚   â””â”€â”€ DecisionQualityScorer.ts   # å†³ç­–è´¨é‡è¯„åˆ†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”œâ”€â”€ ChatTrainer.ts             # èŠå¤©è®­ç»ƒå™¨
â”‚   â”‚   â”œâ”€â”€ ChatDataCollector.ts       # èŠå¤©æ•°æ®æ”¶é›†å™¨
â”‚   â”‚   â”œâ”€â”€ ChatQualityEvaluator.ts    # èŠå¤©è´¨é‡è¯„ä¼°å™¨
â”‚   â”‚   â”œâ”€â”€ PromptOptimizer.ts         # Promptä¼˜åŒ–å™¨
â”‚   â”‚   â””â”€â”€ ChatModelFineTuner.ts       # èŠå¤©æ¨¡å‹å¾®è°ƒå™¨ï¼ˆå¯é€‰ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ hybrid/
â”‚   â”‚   â”œâ”€â”€ HybridTrainer.ts           # æ··åˆè®­ç»ƒå™¨
â”‚   â”‚   â””â”€â”€ CorrelationAnalyzer.ts     # ç›¸å…³æ€§åˆ†æå™¨
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ FastGameRunner.ts           # å¿«é€Ÿæ¸¸æˆè¿è¡Œå™¨
â”‚       â”œâ”€â”€ TrainingMetrics.ts          # è®­ç»ƒæŒ‡æ ‡
â”‚       â””â”€â”€ DataExporter.ts             # æ•°æ®å¯¼å‡º
â”‚
â””â”€â”€ types/
    â””â”€â”€ training.ts                     # è®­ç»ƒç›¸å…³ç±»å‹å®šä¹‰
```

### å…³é”®æ¥å£

```typescript
// è®­ç»ƒæ§åˆ¶å™¨æ¥å£
interface ITrainingController {
  startTraining(config: TrainingConfig): Promise<void>;
  stopTraining(): void;
  getProgress(): TrainingProgress;
  getMetrics(): TrainingMetrics;
}

// è®­ç»ƒæ‰§è¡Œå™¨æ¥å£
interface ITrainingExecutor {
  executeRound(): Promise<TrainingRoundResult>;
  evaluateQuality(): Promise<QualityMetrics>;
  updateParameters(params: TrainingParameters): void;
}

// æ•°æ®æ”¶é›†å™¨æ¥å£
interface IDataCollector {
  collect(sample: TrainingSample): void;
  evaluateQuality(): Promise<void>;
  exportData(): Promise<string>;
  importData(data: string): Promise<void>;
}
```

---

## ğŸ“Š è®­ç»ƒæ•ˆæœè¯„ä¼°

### æ‰“ç‰Œç®—æ³•è®­ç»ƒè¯„ä¼°

1. **èƒœç‡æå‡**
   - è®­ç»ƒå‰èƒœç‡ vs è®­ç»ƒåèƒœç‡
   - ä¸åŒå¯¹æ‰‹éš¾åº¦ä¸‹çš„èƒœç‡

2. **å†³ç­–è´¨é‡**
   - å¹³å‡å†³ç­–ç½®ä¿¡åº¦
   - LLMè¯„ä¼°åˆ†æ•°
   - æ¸¸æˆç»“æœéªŒè¯

3. **å‚æ•°ä¼˜åŒ–æ•ˆæœ**
   - MCTSå‚æ•°å¯¹æ€§èƒ½çš„å½±å“
   - æœ€ä¼˜å‚æ•°ç»„åˆ

### èŠå¤©è®­ç»ƒè¯„ä¼°

1. **è´¨é‡æŒ‡æ ‡**
   - å¹³å‡è´¨é‡åˆ†æ•°
   - ç›¸å…³æ€§ã€è¶£å‘³æ€§ã€å¤šæ ·æ€§

2. **Promptä¼˜åŒ–æ•ˆæœ**
   - ä¸åŒPromptçš„è´¨é‡å¯¹æ¯”
   - æœ€ä¼˜Promptçš„æ€§èƒ½

3. **ç”¨æˆ·ä½“éªŒ**
   - èŠå¤©æ˜¯å¦æ›´è‡ªç„¶
   - æ˜¯å¦æ›´è´´åˆæ¸¸æˆåœºæ™¯

---

## ğŸ¯ å®æ–½å»ºè®®

### é˜¶æ®µ1ï¼šåŸºç¡€å®ç°ï¼ˆ1-2å‘¨ï¼‰
1. å®ç°å¿«é€Ÿæ¸¸æˆæ¨¡å¼
2. å®ç°æ•°æ®æ”¶é›†å™¨
3. å®ç°åŸºç¡€çš„è´¨é‡è¯„ä¼°

### é˜¶æ®µ2ï¼šLLMé›†æˆï¼ˆ1å‘¨ï¼‰
1. å®ç°LLMå†³ç­–è¯„ä¼°å™¨
2. å®ç°LLMèŠå¤©è´¨é‡è¯„ä¼°å™¨
3. å®ç°Promptä¼˜åŒ–å™¨

### é˜¶æ®µ3ï¼šè®­ç»ƒå¾ªç¯ï¼ˆ1å‘¨ï¼‰
1. å®ç°MCTSè®­ç»ƒå™¨
2. å®ç°èŠå¤©è®­ç»ƒå™¨
3. å®ç°æ··åˆè®­ç»ƒå™¨

### é˜¶æ®µ4ï¼šä¼˜åŒ–å’Œæµ‹è¯•ï¼ˆ1å‘¨ï¼‰
1. ä¼˜åŒ–è®­ç»ƒæ•ˆç‡
2. å®Œå–„è¯„ä¼°æŒ‡æ ‡
3. æµ‹è¯•è®­ç»ƒæ•ˆæœ

---

## â“ å…³é”®é—®é¢˜

1. **LLMè°ƒç”¨æˆæœ¬**
   - æ˜¯å¦éœ€è¦é™åˆ¶LLMè°ƒç”¨é¢‘ç‡ï¼Ÿ
   - æ˜¯å¦éœ€è¦ç¼“å­˜è¯„ä¼°ç»“æœï¼Ÿ

2. **è®­ç»ƒæ•°æ®å­˜å‚¨**
   - æœ¬åœ°å­˜å‚¨è¿˜æ˜¯äº‘ç«¯ï¼Ÿ
   - æ•°æ®é‡å¤§å°ï¼Ÿ

3. **è®­ç»ƒæ—¶é—´**
   - å•æ¬¡è®­ç»ƒéœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ
   - æ˜¯å¦éœ€è¦åå°è®­ç»ƒï¼Ÿ

4. **æ¨¡å‹å¾®è°ƒ**
   - æ˜¯å¦æ”¯æŒLLMå¾®è°ƒï¼Ÿ
   - å¾®è°ƒèµ„æºéœ€æ±‚ï¼Ÿ

---

## ğŸ“ æ€»ç»“

è¿™ä¸ªè®¾è®¡æ–¹æ¡ˆæä¾›äº†ï¼š

1. **LLMå‚ä¸æ‰“ç‰Œè®­ç»ƒ**çš„ä¸‰ç§æ–¹å¼ï¼š
   - å†³ç­–è´¨é‡è¯„ä¼°
   - ç­–ç•¥åˆ†æ
   - å‚æ•°ä¼˜åŒ–å»ºè®®

2. **èŠå¤©è®­ç»ƒ**çš„å®Œæ•´æµç¨‹ï¼š
   - æ•°æ®æ”¶é›†
   - è´¨é‡è¯„ä¼°
   - Promptä¼˜åŒ–
   - æ¨¡å‹å¾®è°ƒï¼ˆå¯é€‰ï¼‰

3. **æ··åˆè®­ç»ƒ**ç­–ç•¥ï¼š
   - MCTS + LLM ååŒè®­ç»ƒ
   - æ•°æ®å…±äº«å’Œå…³è”åˆ†æ

4. **å®ç°æ¶æ„**ï¼š
   - æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†
   - å¯æ‰©å±•çš„æ¥å£è®¾è®¡

æ¥ä¸‹æ¥å¯ä»¥å¼€å§‹å®ç°å…·ä½“çš„æ¨¡å—äº†ï¼

