# 下一步工作计划

## 🎯 当前状态

✅ **所有核心功能已完成**
- QuarrelVoiceService 实现完成
- 错误处理和重试机制完成
- 文档完整
- 测试示例就绪

## 📋 立即可以做的（不需要显卡）

### 1. 游戏集成 ⏳
- [ ] 在 `ChatService` 中集成 `QuarrelVoiceService`
- [ ] 在 `useChatBubbles` 中集成
- [ ] 测试对骂场景
- [ ] 测试并发播放效果

### 2. 测试和优化 ⏳
- [ ] 运行测试示例 (`docs/examples/test-quarrel-voice.ts`)
- [ ] 测试各种场景（对骂、短插一句、长吵架）
- [ ] 性能测试（并发播放、队列管理）
- [ ] 用户体验测试

### 3. 参数调优 ⏳
- [ ] 调整ducking参数（otherLevel）
- [ ] 调整pan值分布
- [ ] 调整并发限制
- [ ] 调整重试参数

### 4. 错误处理增强 ⏳
- [ ] 添加更多错误场景的处理
- [ ] 优化错误日志
- [ ] 添加用户友好的错误提示

## 🔧 需要显卡的功能

### 1. 南昌话LoRA训练 ⏳
- [ ] 准备训练数据（300-500条）
- [ ] 配置训练环境
- [ ] 训练LoRA模型
- [ ] 集成到系统

### 2. GPT-SoVITS南昌声线 ⏳
- [ ] 录制南昌话素材（30-60分钟）
- [ ] 配置GPT-SoVITS环境
- [ ] 训练声线模型
- [ ] 集成到TTS服务

### 3. 吵架王风格训练 ⏳
- [ ] 准备训练数据（300-500条互怼样本）
- [ ] 配置训练环境
- [ ] QLoRA SFT训练
- [ ] DPO偏好优化（可选）
- [ ] 集成到LLM策略

## 🚀 推荐执行顺序

### 第一阶段：集成和测试（1-2天）
1. 在 `ChatService` 中集成 `QuarrelVoiceService`
2. 运行测试示例
3. 测试对骂场景
4. 调整参数

### 第二阶段：优化（2-3天）
1. 性能优化
2. 错误处理增强
3. 用户体验优化
4. 文档完善

### 第三阶段：训练（需要显卡）
1. 南昌话LoRA训练
2. GPT-SoVITS南昌声线训练
3. 吵架王风格训练

## 📝 具体任务清单

### 任务1：ChatService集成
- [ ] 修改 `src/services/chatService.ts`
- [ ] 在 `triggerTaunt` 中集成 `QuarrelVoiceService`
- [ ] 在 `triggerReply` 中集成 `QuarrelVoiceService`
- [ ] 添加配置选项
- [ ] 测试

### 任务2：useChatBubbles集成
- [ ] 修改 `src/hooks/useChatBubbles.ts`
- [ ] 使用 `useQuarrelVoice` Hook
- [ ] 根据消息类型选择服务
- [ ] 测试

### 任务3：测试套件
- [ ] 运行 `docs/examples/test-quarrel-voice.ts`
- [ ] 测试所有场景
- [ ] 记录测试结果
- [ ] 修复发现的问题

### 任务4：性能优化
- [ ] 监控队列长度
- [ ] 优化并发控制
- [ ] 优化音频缓存
- [ ] 优化LLM调用

## 🎯 成功标准

### 功能完整性
- ✅ 所有核心功能已实现
- ⏳ 集成到游戏主流程
- ⏳ 测试通过

### 性能指标
- ⏳ 并发播放延迟 < 100ms
- ⏳ 队列积压 < 5条
- ⏳ 错误率 < 1%

### 用户体验
- ⏳ 对骂场景流畅
- ⏳ 声音清晰不重叠
- ⏳ 响应及时

---

**最后更新**：2025-01-25  
**状态**：✅ 核心功能完成，待集成和测试

