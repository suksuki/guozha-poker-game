# LLMå¤šè¯­è¨€ç”Ÿæˆå®ç°è¯´æ˜

## ğŸ“‹ å®ç°æ¦‚è¿°

å·²å®ç°æ–¹æ¡ˆAï¼šè®©LLMæ ¹æ®å½“å‰è¯­è¨€ç›´æ¥ç”Ÿæˆå¯¹åº”è¯­è¨€çš„æ–‡æœ¬ï¼Œè€Œä¸æ˜¯ç”Ÿæˆä¸­æ–‡å†ç¿»è¯‘ã€‚

## ğŸ”„ å·¥ä½œæµç¨‹

### æ–°æµç¨‹ï¼ˆå¯ç”¨å¤šè¯­è¨€ï¼‰

```
æ£€æŸ¥i18n.language
  â†“
LLM Promptæ·»åŠ è¯­è¨€è¦æ±‚
  â”œâ”€> ä¸­æ–‡ â†’ "ä½¿ç”¨ä¸­æ–‡å›å¤"
  â”œâ”€> è‹±æ–‡ â†’ "Use English to reply"
  â”œâ”€> æ—¥è¯­ â†’ "æ—¥æœ¬èªã§è¿”ä¿¡ã—ã¦ãã ã•ã„"
  â””â”€> éŸ©è¯­ â†’ "í•œêµ­ì–´ë¡œ ë‹µë³€í•˜ì„¸ìš”"
  â†“
LLMç”Ÿæˆå¯¹åº”è¯­è¨€çš„æ–‡æœ¬
  â†“
useChatBubblesæ£€æµ‹åˆ°æ–°æ¶ˆæ¯
  â†“
translateText()æ£€æµ‹è¯­è¨€
  â”œâ”€> å¦‚æœå·²ç»æ˜¯ç›®æ ‡è¯­è¨€ â†’ ç›´æ¥ä½¿ç”¨ï¼ˆä¸ç¿»è¯‘ï¼‰
  â””â”€> å¦‚æœä¸æ˜¯ç›®æ ‡è¯­è¨€ â†’ ç¿»è¯‘ï¼ˆä½œä¸ºå›é€€ï¼‰
  â†“
æ˜¾ç¤ºæ°”æ³¡å’Œæ’­æ”¾è¯­éŸ³
```

### å›é€€æœºåˆ¶

å¦‚æœLLMç”Ÿæˆçš„è¯­è¨€ä¸æ­£ç¡®ï¼Œ`translateText()`ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ç¿»è¯‘ï¼š
- å¦‚æœæ–‡æœ¬å·²ç»æ˜¯ç›®æ ‡è¯­è¨€ â†’ ä¸ç¿»è¯‘
- å¦‚æœæ–‡æœ¬ä¸æ˜¯ç›®æ ‡è¯­è¨€ â†’ è°ƒç”¨ç¿»è¯‘API

## ğŸ”§ å®ç°ç»†èŠ‚

### 1. è¯­è¨€è¦æ±‚ç”Ÿæˆ

**ä½ç½®**ï¼š`src/chat/strategy/LLMChatStrategy.ts`

```typescript
private getLanguageRequirement(): string {
  // å¦‚æœæœªå¯ç”¨å¤šè¯­è¨€ï¼ŒLLMåªç”Ÿæˆä¸­æ–‡
  if (this.config.enableMultilingual === false) {
    return 'ä½¿ç”¨ä¸­æ–‡å›å¤';
  }
  
  const currentLang = i18n.language || 'zh-CN';
  
  // æ ¹æ®è¯­è¨€è¿”å›å¯¹åº”çš„è¦æ±‚
  if (currentLang.startsWith('zh')) {
    return 'ä½¿ç”¨ä¸­æ–‡å›å¤';
  }
  
  const langMap: Record<string, string> = {
    'en': 'Use English to reply',
    'en-US': 'Use English to reply',
    'ja': 'æ—¥æœ¬èªã§è¿”ä¿¡ã—ã¦ãã ã•ã„',
    'ja-JP': 'æ—¥æœ¬èªã§è¿”ä¿¡ã—ã¦ãã ã•ã„',
    'ko': 'í•œêµ­ì–´ë¡œ ë‹µë³€í•˜ì„¸ìš”',
    'ko-KR': 'í•œêµ­ì–´ë¡œ ë‹µë³€í•˜ì„¸ìš”',
  };
  
  // åŒ¹é…å¹¶è¿”å›
  // ...
}
```

### 2. Promptä¿®æ”¹

**ä½ç½®**ï¼š`src/chat/strategy/LLMChatStrategy.ts`

```typescript
private buildPrompt(player: Player, eventType: ChatEventType, context?: ChatContext): string {
  const langRequirement = this.getLanguageRequirement();
  
  return `${this.config.systemPrompt || ''}

## è¯­è¨€è¦æ±‚
${langRequirement}

## æ¸¸æˆä¿¡æ¯
${gameInfo}
...`;
}
```

### 3. System Promptæ›´æ–°

**ä½ç½®**ï¼š`src/config/chatConfig.ts`

```typescript
systemPrompt: `ä½ æ˜¯ä¸€ä¸ªè¿‡ç‚¸ç‰Œæ¸¸æˆçš„AIç©å®¶ï¼Œéœ€è¦æ ¹æ®æ¸¸æˆæƒ…å†µç”Ÿæˆè‡ªç„¶ã€æœ‰è¶£çš„èŠå¤©å†…å®¹ã€‚

è¯­è¨€è¦æ±‚ï¼š
- æ ¹æ®"è¯­è¨€è¦æ±‚"éƒ¨åˆ†çš„æŒ‡ç¤ºï¼Œä½¿ç”¨å¯¹åº”çš„è¯­è¨€å›å¤
- å¦‚æœè¦æ±‚ä½¿ç”¨ä¸­æ–‡ï¼Œä½¿ç”¨ä¸­æ–‡å›å¤
- å¦‚æœè¦æ±‚ä½¿ç”¨å…¶ä»–è¯­è¨€ï¼ˆå¦‚è‹±è¯­ã€æ—¥è¯­ã€éŸ©è¯­ç­‰ï¼‰ï¼Œä½¿ç”¨å¯¹åº”è¯­è¨€å›å¤
- ä¿æŒè¯­è¨€åœ°é“è‡ªç„¶ï¼Œç¬¦åˆè¯¥è¯­è¨€çš„è¡¨è¾¾ä¹ æƒ¯
...`
```

### 4. é…ç½®é€‰é¡¹

**ä½ç½®**ï¼š`src/config/chatConfig.ts`

```typescript
export interface LLMChatConfig {
  // ...
  enableMultilingual?: boolean; // æ˜¯å¦å¯ç”¨LLMå¤šè¯­è¨€ç”Ÿæˆï¼ˆé»˜è®¤trueï¼‰
}

export const DEFAULT_LLM_CHAT_CONFIG: LLMChatConfig = {
  // ...
  enableMultilingual: true, // å¯ç”¨LLMå¤šè¯­è¨€ç”Ÿæˆ
};
```

## ğŸ“Š æ”¯æŒçš„è¯­è¨€

å½“å‰æ”¯æŒçš„è¯­è¨€è¦æ±‚ï¼š

| è¯­è¨€ä»£ç  | è¯­è¨€è¦æ±‚ |
|---------|---------|
| zh-CN, zh | ä½¿ç”¨ä¸­æ–‡å›å¤ |
| en-US, en | Use English to reply |
| ja-JP, ja | æ—¥æœ¬èªã§è¿”ä¿¡ã—ã¦ãã ã•ã„ |
| ko-KR, ko | í•œêµ­ì–´ë¡œ ë‹µë³€í•˜ì„¸ìš” |
| å…¶ä»– | Use {language} language to reply |

## âš™ï¸ é…ç½®é€‰é¡¹

### å¯ç”¨/ç¦ç”¨å¤šè¯­è¨€ç”Ÿæˆ

```typescript
import { chatService } from './services/chatService';

// å¯ç”¨å¤šè¯­è¨€ç”Ÿæˆï¼ˆé»˜è®¤ï¼‰
chatService.updateLLMConfig({
  enableMultilingual: true
});

// ç¦ç”¨å¤šè¯­è¨€ç”Ÿæˆï¼ˆLLMåªç”Ÿæˆä¸­æ–‡ï¼Œç„¶åç¿»è¯‘ï¼‰
chatService.updateLLMConfig({
  enableMultilingual: false
});
```

## ğŸ”„ å›é€€æœºåˆ¶

### è‡ªåŠ¨æ£€æµ‹å’Œç¿»è¯‘

`translateText()`ä¼šè‡ªåŠ¨æ£€æµ‹LLMç”Ÿæˆçš„è¯­è¨€ï¼š

```typescript
// å¦‚æœæ–‡æœ¬å·²ç»æ˜¯ç›®æ ‡è¯­è¨€ï¼Œä¸éœ€è¦ç¿»è¯‘
if (detectedLang === currentLang) {
  return text; // ç›´æ¥ä½¿ç”¨
}

// å¦‚æœæ–‡æœ¬ä¸æ˜¯ç›®æ ‡è¯­è¨€ï¼Œç¿»è¯‘
const translated = await translateWithAPI(text, currentLang);
```

### ç¿»è¯‘ä½œä¸ºå›é€€

å¦‚æœLLMç”Ÿæˆçš„è¯­è¨€ä¸æ­£ç¡®ï¼Œç¿»è¯‘æœåŠ¡ä¼šè‡ªåŠ¨å¤„ç†ï¼š
- LLMç”Ÿæˆäº†ä¸­æ–‡ï¼Œä½†å½“å‰è¯­è¨€æ˜¯è‹±æ–‡ â†’ è‡ªåŠ¨ç¿»è¯‘æˆè‹±æ–‡
- LLMç”Ÿæˆäº†è‹±æ–‡ï¼Œä½†å½“å‰è¯­è¨€æ˜¯ä¸­æ–‡ â†’ ç›´æ¥ä½¿ç”¨ï¼ˆå› ä¸ºç›®æ ‡è¯­è¨€æ˜¯ä¸­æ–‡ï¼‰

## ğŸ¯ ä¼˜åŠ¿

1. **æ›´åœ°é“**ï¼šLLMç›´æ¥ç”Ÿæˆï¼Œè¯­è¨€æ›´è‡ªç„¶
2. **æ— å»¶è¿Ÿ**ï¼šå¦‚æœLLMç”Ÿæˆæ­£ç¡®ï¼Œä¸éœ€è¦ç¿»è¯‘APIè°ƒç”¨
3. **ä¿ç•™ç‰¹è‰²**ï¼šè¯­è¨€ç‰¹è‰²å’Œæ–‡åŒ–èƒŒæ™¯ä¸ä¼šä¸¢å¤±
4. **è‡ªåŠ¨å›é€€**ï¼šå¦‚æœç”Ÿæˆä¸æ­£ç¡®ï¼Œè‡ªåŠ¨ä½¿ç”¨ç¿»è¯‘

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **LLMå¤šè¯­è¨€èƒ½åŠ›**ï¼šéœ€è¦LLMæ”¯æŒå¤šè¯­è¨€ç”Ÿæˆï¼ˆqwen2ç­‰æ¨¡å‹é€šå¸¸æ”¯æŒï¼‰
2. **ç”Ÿæˆè´¨é‡**ï¼šä¸åŒè¯­è¨€çš„ç”Ÿæˆè´¨é‡å¯èƒ½ä¸åŒ
3. **Promptå¤æ‚åº¦**ï¼šå¤šè¯­è¨€Promptå¯èƒ½æ¯”å•è¯­è¨€Promptå¤æ‚

## ğŸš€ æœªæ¥ä¼˜åŒ–

### æ–¹æ¡ˆï¼šç¿»è¯‘LLMå¤„ç†

å¦‚æœLLMå¤šè¯­è¨€ç”Ÿæˆè´¨é‡ä¸å¥½ï¼Œå¯ä»¥ä½¿ç”¨ä¸“é—¨çš„ç¿»è¯‘LLMï¼š

```typescript
// 1. LLMç”Ÿæˆä¸­æ–‡
const chineseContent = await llmStrategy.generateEventChat(player, eventType, context);

// 2. å¦‚æœå½“å‰è¯­è¨€ä¸æ˜¯ä¸­æ–‡ï¼Œä½¿ç”¨ç¿»è¯‘LLM
if (currentLang !== 'zh-CN') {
  const translatedContent = await translationLLM.translate(chineseContent, currentLang);
  return translatedContent;
}

return chineseContent;
```

**ä¼˜ç‚¹**ï¼š
- ç¿»è¯‘è´¨é‡æ›´å¥½ï¼ˆä¸“é—¨çš„ç¿»è¯‘æ¨¡å‹ï¼‰
- å¯ä»¥ä¿æŒæ¸¸æˆæœ¯è¯­çš„ä¸€è‡´æ€§

**å®ç°æ­¥éª¤**ï¼š
1. åˆ›å»ºç¿»è¯‘LLMå®¢æˆ·ç«¯
2. åœ¨`useChatBubbles`ä¸­ï¼Œå¦‚æœLLMç”Ÿæˆä¸­æ–‡ä½†å½“å‰è¯­è¨€ä¸æ˜¯ä¸­æ–‡ï¼Œè°ƒç”¨ç¿»è¯‘LLM
3. é…ç½®ç¿»è¯‘LLMæ¨¡å‹ï¼ˆå¯ä»¥ä½¿ç”¨è¾ƒå°çš„ç¿»è¯‘ä¸“ç”¨æ¨¡å‹ï¼‰

---

**æœ€åæ›´æ–°**ï¼š2025-01-25
**çŠ¶æ€**ï¼šå·²å®ç°æ–¹æ¡ˆA

