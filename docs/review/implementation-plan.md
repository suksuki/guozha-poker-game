# 合作模式功能实施计划

## 📋 总体目标

实现完整的合作模式游戏，包括：
- 团队计分系统
- 方位布局（东南西北）
- AI建议系统增强（MCTS + LLM推理链）
- 聊天系统重新设计
- 信息提取机制
- 信息共享机制

---

## 🎯 实施阶段

### 阶段1：基础架构（核心）⭐⭐⭐⭐⭐

**目标**：建立合作模式的基础框架

#### 1.1 团队系统
- [ ] 定义团队数据结构
- [ ] 4人/6人模式支持
- [ ] 团队分配逻辑
- [ ] 团队关系管理

#### 1.2 方位布局系统
- [ ] 4人模式：东南西北布局
- [ ] 团队视觉区分
- [ ] 位置标识和UI

#### 1.3 团队计分系统
- [ ] 从个人分数改为团队分数
- [ ] 轮次分数分配给团队
- [ ] 最终规则调整（团队胜负）
- [ ] UI显示团队分数

**预计工作量**：2-3天

---

### 阶段2：核心玩法（重要）⭐⭐⭐⭐⭐

**目标**：实现合作模式的核心机制

#### 2.1 主动"要不起"机制
- [ ] 允许玩家主动选择"要不起"
- [ ] 即使有大牌也可以要不起
- [ ] 确认机制（防止误操作）
- [ ] 记录决策原因

#### 2.2 MCTS算法适配合作模式
- [ ] 调整评估函数（团队收益优先）
- [ ] 支持"主动要不起"动作
- [ ] 信息状态建模（部分信息）
- [ ] 队友协调机制

#### 2.3 信息共享系统（基础）
- [ ] 玩家可以向队友共享信息
- [ ] AI队友可以分析信息
- [ ] 基础的信息提示UI

**预计工作量**：3-4天

---

### 阶段3：AI增强（核心）⭐⭐⭐⭐⭐

**目标**：实现MCTS + LLM推理链系统

#### 3.1 MCTS + LLM集成
- [ ] MCTS计算模块
- [ ] LLM推理链生成
- [ ] 推理链解析和展示
- [ ] 多建议生成系统

#### 3.2 AI建议系统增强
- [ ] 提供多个出牌选择
- [ ] 每个选择都有详细推理
- [ ] 推理链可视化
- [ ] 交互式建议界面

#### 3.3 AI玩家自主决策
- [ ] AI使用推理链决策
- [ ] 自主学习机制
- [ ] 决策记录和优化

**预计工作量**：4-5天

---

### 阶段4：聊天系统重构（重要）⭐⭐⭐⭐

**目标**：重新设计聊天系统，支持打牌沟通和对骂

#### 4.1 聊天内容分类
- [ ] 打牌相关聊天
- [ ] 对骂、互相指责
- [ ] 策略沟通（合作模式）
- [ ] 情绪表达

#### 4.2 聊天触发机制
- [ ] 基于游戏事件触发
- [ ] 基于角色性格生成
- [ ] 基于游戏状态调整

#### 4.3 信息提取系统
- [ ] 从聊天中提取隐藏信息
- [ ] 信息分析界面
- [ ] 置信度评估
- [ ] 准确度验证

**预计工作量**：3-4天

---

### 阶段5：高级功能（增强）⭐⭐⭐

**目标**：增加游戏深度和趣味性

#### 5.1 时机奖励系统
- [ ] 连击奖励
- [ ] 反击奖励
- [ ] 完美时机奖励

#### 5.2 组合牌型（可选）
- [ ] 队友组合出牌机制
- [ ] 组合奖励系统

#### 5.3 其他创新功能
- [ ] 动态规则
- [ ] 资源管理
- [ ] 等等

**预计工作量**：按需实现

---

## 🚀 推荐实施顺序

### 第一周：基础架构
1. 团队系统和计分
2. 方位布局
3. 基础合作机制

### 第二周：核心玩法
1. 主动"要不起"机制
2. MCTS适配
3. 基础信息共享

### 第三周：AI增强
1. MCTS + LLM集成
2. AI建议系统
3. 推理链展示

### 第四周：聊天系统
1. 聊天系统重构
2. 信息提取
3. 完善和优化

---

## 📝 详细实施步骤

### Step 1: 团队系统和计分（今天开始）

#### 1.1 数据结构定义

需要创建/修改的文件：
- `src/types/team.ts` - 团队类型定义
- `src/utils/teamManager.ts` - 团队管理
- `src/utils/gameRules.ts` - 修改计分规则

#### 1.2 计分规则修改

需要修改的文件：
- `src/utils/Game.ts` - 分数分配逻辑
- `src/utils/gameController.ts` - 控制器计分
- `src/utils/gameRules.ts` - 最终规则

#### 1.3 UI显示

需要修改的文件：
- `src/components/game/PlayerInfo.tsx` - 显示团队信息
- `src/components/game/ScoreBoard.tsx` - 团队分数显示
- `src/components/MultiPlayerGameBoard.tsx` - 整体布局

---

## 🎯 今天开始：第一步

建议从**团队系统和计分**开始，因为这是最基础的功能。

### 第一步：定义团队数据结构

准备好了吗？我们从这里开始！

