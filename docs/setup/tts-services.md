# TTS 服务配置指南

## 概述

游戏支持多个 TTS（文本转语音）服务提供者，按优先级自动选择：

1. **GPT-SoVITS** (端口 9880) - 本地服务，支持声音克隆
2. **Coqui TTS** (端口 5002) - 本地服务，多语言支持
3. **Edge TTS** - 在线服务（需要后端代理）
4. **本地 TTS API** (端口 8000) - 本地服务
5. **浏览器 TTS** - 浏览器内置，总是可用（后备）

## 当前状态

如果你看到这些错误：
```
POST http://localhost:9880/tts net::ERR_CONNECTION_REFUSED
POST http://localhost:5002/api/tts net::ERR_CONNECTION_REFUSED
```

**这是正常的！** 这些服务是可选的，如果未启动，系统会自动使用其他可用的 TTS 提供者（通常是浏览器 TTS）。

## 选项 1：忽略这些错误（推荐）

如果你不需要高质量的语音合成，可以忽略这些错误。系统会自动使用浏览器 TTS，这是最简单的方式，无需任何配置。

**优点：**
- 无需安装任何服务
- 开箱即用
- 不占用额外资源

**缺点：**
- 音质可能不如专业 TTS 服务
- 不支持声音克隆

## 选项 2：禁用这些服务

如果你想完全禁用这些服务的健康检查，可以修改代码（但这通常不需要，因为系统会自动降级）。

## 选项 3：启动 TTS 服务（高级）

如果你需要更好的音质或声音克隆功能，可以启动这些服务：

### GPT-SoVITS（推荐用于声音克隆）

**安装和启动：**

1. **克隆 GPT-SoVITS 仓库：**
   ```bash
   git clone https://github.com/RVC-Boss/GPT-SoVITS.git
   cd GPT-SoVITS
   ```

2. **安装依赖：**
   ```bash
   pip install -r requirements.txt
   ```

3. **启动服务：**
   ```bash
   # 启动 API 服务（默认端口 9880）
   python api.py
   ```

4. **验证服务：**
   ```bash
   curl http://localhost:9880/health
   ```

**配置游戏：**

游戏会自动检测 GPT-SoVITS 服务。如果服务运行在默认端口（9880），无需额外配置。

### Coqui TTS

**安装和启动：**

1. **安装 Coqui TTS：**
   ```bash
   pip install TTS
   ```

2. **启动服务：**
   ```bash
   # 启动 Coqui TTS 服务器（默认端口 5002）
   tts-server --port 5002
   ```

3. **验证服务：**
   ```bash
   curl http://localhost:5002/api/tts
   ```

**配置游戏：**

游戏会自动检测 Coqui TTS 服务。如果服务运行在默认端口（5002），无需额外配置。

## 检查 TTS 服务状态

在游戏界面中：

1. 打开游戏配置面板
2. 查看 TTS 服务状态
3. 应该看到：
   - ✅ 浏览器 TTS - 健康（总是可用）
   - ❌ GPT-SoVITS - 不健康（如果未启动）
   - ❌ Coqui TTS - 不健康（如果未启动）

## 常见问题

### Q: 这些错误会影响游戏吗？

**A:** 不会。系统会自动降级到可用的 TTS 提供者（通常是浏览器 TTS）。游戏可以正常使用。

### Q: 如何完全禁用这些服务的检查？

**A:** 通常不需要。系统会自动处理服务不可用的情况。如果你真的想禁用，可以修改 `src/tts/ttsServiceManager.ts` 中的配置。

### Q: 启动服务后还是连接失败？

**检查：**
1. 服务是否真的在运行：`curl http://localhost:9880/health`
2. 端口是否正确
3. CORS 设置是否正确（服务需要允许跨域请求）
4. 防火墙是否阻止了端口

### Q: 如何选择使用哪个 TTS 服务？

**A:** 系统按优先级自动选择：
1. 检查 GPT-SoVITS（如果可用）
2. 检查 Coqui TTS（如果可用）
3. 检查 Edge TTS（如果可用）
4. 检查本地 TTS API（如果可用）
5. 使用浏览器 TTS（总是可用）

## 推荐配置

### 最小配置（推荐新手）

- **不启动任何本地服务**
- 使用浏览器 TTS
- 优点：简单，无需配置

### 标准配置

- **启动 GPT-SoVITS**（如果需要声音克隆）
- 或启动 **Coqui TTS**（如果需要多语言支持）
- 优点：更好的音质

### 完整配置

- **启动所有服务**
- 优点：最佳音质和功能
- 缺点：占用更多资源

## 总结

**对于大多数用户：**
- ✅ 忽略这些错误
- ✅ 使用浏览器 TTS（自动）
- ✅ 无需任何配置

**对于高级用户：**
- 如果需要更好的音质，启动 GPT-SoVITS 或 Coqui TTS
- 参考上面的安装步骤

这些错误信息只是告诉你某些可选服务未启动，不会影响游戏的正常使用。

