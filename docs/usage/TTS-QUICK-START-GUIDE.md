# TTS配置系统 - 快速使用指南

## 🎯 TTS服务器选择方式

新的TTS系统提供**两种**选择TTS服务器的方式：

### 方式1：全局优先级（自动选择）⭐ 推荐

系统会自动按优先级选择TTS服务器：
- **数字越小，优先级越高**（1 > 2 > 3）
- 只使用**已启用且可用**的服务器
- 首选服务器失败时，**自动回退**到下一个

### 方式2：场景化配置（精细控制）

为不同场景指定不同的TTS服务器：
- **系统音效**：过、要不起等提示音
- **聊天语音**：AI玩家对话（最重要）
- **报牌语音**：大小王、同花顺等播报
- **AI对话音**：想法生成、策略分析

---

## 🚀 快速配置指南

### 步骤1：调整服务器优先级

1. 打开 **游戏配置** → **🔊 TTS 语音配置**
2. 在服务器列表中，**点击**服务器名称右边的 **"优先级: X"**
3. 输入新的优先级数字
4. 按回车保存

**推荐配置**：
```
优先级 1: 局域网 Piper (192.168.0.13:5000) ← 11ms，最快
优先级 2: 本地 Piper (localhost:5000)      ← 备用
优先级 3: 浏览器 TTS                       ← 兜底
```

### 步骤2：启用本地Piper（可选）

如果您想使用本地Piper作为备用：

#### 在您的开发机(WSL)上启动：
```bash
cd /home/jin/guozha_poker_game

# 启动本地Piper
source venv-piper/bin/activate
nohup python3 scripts/piper-tts-server.py > /tmp/piper-local.log 2>&1 &

# 测试
sleep 3
curl http://localhost:5000/health
```

然后在前端中：
- 找到 **"本地 Piper TTS"** 服务器
- **打开启用开关** ✅

### 步骤3：配置场景TTS

滚动到**场景配置**部分，您会看到4个场景：

#### 🔔 系统音效
- 用途：过、要不起等提示音
- 推荐：**浏览器 TTS**（快速响应）

#### 💬 聊天语音 ⭐ 重点
- 用途：AI玩家对话
- 推荐：**局域网 Piper**（质量好、延迟低）

#### 📢 报牌语音
- 用途：大小王、同花顺等播报
- 推荐：**局域网 Piper**（清晰播报）

#### 🤖 AI对话音
- 用途：想法生成、策略分析
- 推荐：**局域网 Piper** 或 **本地 Piper**

每个场景选择：
- **🔄 自动选择**：使用全局优先级
- **指定服务器**：使用特定的TTS服务器

---

## 📋 配置示例

### 示例1：全部使用局域网Piper（最简单）

**全局优先级**：
- 局域网 Piper: 优先级 1 ✅ 启用
- 浏览器 TTS: 优先级 2 ✅ 启用

**场景配置**：
- 所有场景选择：**🔄 自动选择**

**效果**：所有语音都使用局域网Piper，失败时回退到浏览器TTS

### 示例2：场景化配置（精细控制）

**全局优先级**：
- 局域网 Piper: 优先级 1 ✅ 启用
- 本地 Piper: 优先级 2 ✅ 启用
- 浏览器 TTS: 优先级 3 ✅ 启用

**场景配置**：
- 🔔 系统音效 → **浏览器 TTS**（快速）
- 💬 聊天语音 → **局域网 Piper**（质量好）
- 📢 报牌语音 → **局域网 Piper**（清晰）
- 🤖 AI对话音 → **本地 Piper**（不占用网络）

**效果**：不同场景使用不同TTS，最优化的体验

---

## 🔧 故障排查

### Q: 本地Piper显示❌不可用

**A**: 需要在您的开发机上启动本地Piper服务：
```bash
cd /home/jin/guozha_poker_game
source venv-piper/bin/activate
python3 scripts/piper-tts-server.py &
```

### Q: 如何知道当前使用的是哪个TTS？

**A**: 
1. 查看浏览器控制台（F12）
2. 播放语音时会有日志显示使用的服务器
3. 或者在TTS配置面板查看延迟变化

### Q: 场景配置和全局优先级的关系？

**A**: 
- **场景选择"自动"**：使用全局优先级
- **场景选择特定服务器**：直接使用该服务器，失败时回退到下一个

### Q: 怎么知道哪个服务器最快？

**A**: 
- 查看服务器右边的**延迟数字**（如 11ms）
- 延迟越小越快
- 推荐优先使用延迟最低的服务器

---

## ✅ 完成检查清单

配置完成后，检查：
- [ ] 局域网Piper优先级设为1
- [ ] 浏览器TTS已启用（兜底）
- [ ] 聊天语音场景配置为局域网Piper
- [ ] 报牌语音场景配置为局域网Piper
- [ ] 测试一局游戏，听听AI说话

---

## 🎉 推荐配置（开箱即用）

```
服务器配置：
┌─────────────────────────────────────────┐
│ 优先级 1: 局域网 Piper ✅               │
│   192.168.0.13:5000 (11ms)              │
├─────────────────────────────────────────┤
│ 优先级 2: 浏览器 TTS ✅                 │
│   browser:0 (18ms)                      │
└─────────────────────────────────────────┘

场景配置：
┌─────────────────────────────────────────┐
│ 🔔 系统音效  → 浏览器 TTS (快速响应)   │
│ 💬 聊天语音  → 局域网 Piper (质量好)   │
│ 📢 报牌语音  → 局域网 Piper (清晰)     │
│ 🤖 AI对话音  → 局域网 Piper (稳定)     │
└─────────────────────────────────────────┘
```

这样配置后：
- ✅ 所有重要语音使用高质量的Piper
- ✅ 系统提示音使用快速的浏览器TTS
- ✅ 局域网故障时自动回退到浏览器
- ✅ 延迟低、质量高、稳定性好

---

## 🎊 现在可以：

1. **刷新页面**查看新功能
2. **调整优先级**（点击"优先级: X"）
3. **配置场景TTS**（选择每个场景使用的服务器）
4. **开始游戏**，享受高质量语音！

**所有功能已完成！** 🚀

