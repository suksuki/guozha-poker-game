# æµ‹è¯•ç”¨ä¾‹æ›´æ–°æ–‡æ¡£ (2024)

## ğŸ“‹ æ›´æ–°æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°å¯¹æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹è¿›è¡Œäº†å…¨é¢æ£€æŸ¥å’Œæ›´æ–°ï¼Œä¸»è¦å˜æ›´å¦‚ä¸‹ï¼š

### 1. è¶…æ—¶æ—¶é—´è°ƒæ•´

**å…¨å±€è¶…æ—¶è®¾ç½®ï¼š**
- âœ… `vitest.config.ts`: `testTimeout` ä» 30000ms (30ç§’) è°ƒæ•´ä¸º **5000ms (5ç§’)**
- âœ… `vitest.config.ts`: `hookTimeout` ä» 30000ms (30ç§’) è°ƒæ•´ä¸º **5000ms (5ç§’)**

**æµ‹è¯•ç”¨ä¾‹ä¸­çš„è¶…æ—¶è®¾ç½®ï¼š**
- âœ… `integrationTests.test.ts`: `playTimeout` ä¿æŒ 5000ms
- âœ… `integrationTests.test.ts`: Promise.race è¶…æ—¶ä» 3000ms è°ƒæ•´ä¸º **5000ms**
- âœ… `roundRegression.test.ts`: `playTimeout` ä» 10000ms è°ƒæ•´ä¸º **5000ms**
- âœ… `comprehensiveUnitTests.test.ts`: `playTimeout` ä¿æŒ 5000ms

**Mock è¶…æ—¶è®¾ç½®ï¼š**
- âœ… æ‰€æœ‰ mock çš„å¼‚æ­¥æ“ä½œè¶…æ—¶æ—¶é—´ç»Ÿä¸€è®¾ç½®ä¸º **5ç§’**
- âœ… æ‰€æœ‰ `setTimeout` çš„å»¶è¿Ÿæ—¶é—´ä¿æŒä¸å˜ï¼ˆè¿™äº›æ˜¯æ¨¡æ‹Ÿå»¶è¿Ÿï¼Œä¸æ˜¯è¶…æ—¶ï¼‰

### 2. æµ‹è¯•è„šæœ¬æ›´æ–°

**æ–°å¢æµ‹è¯•è¿è¡Œè„šæœ¬ï¼š**

1. **`scripts/run-all-tests-with-logging.sh`** (Linux/WSL)
   - è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
   - è®°å½•è¯¦ç»†æ—¥å¿—åˆ° `test-logs/` ç›®å½•
   - é‡åˆ°é”™è¯¯ç»§ç»­è¿è¡Œï¼Œä¸ä¸­æ–­
   - ç”Ÿæˆæµ‹è¯•æ‘˜è¦å’Œé”™è¯¯æŠ¥å‘Š

2. **`scripts/run-all-tests-with-logging.js`** (è·¨å¹³å°)
   - Node.js å®ç°ï¼Œæ”¯æŒæ‰€æœ‰å¹³å°
   - åŠŸèƒ½åŒ shell è„šæœ¬
   - æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œè¾“å‡ºè§£æ

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
# ä½¿ç”¨ Node.js è„šæœ¬ï¼ˆæ¨èï¼Œè·¨å¹³å°ï¼‰
npm run test:all-with-logging

# æˆ–ç›´æ¥è¿è¡Œ
node scripts/run-all-tests-with-logging.js

# åœ¨ WSL ä¸­ä½¿ç”¨ shell è„šæœ¬
bash scripts/run-all-tests-with-logging.sh
```

### 3. æ—¥å¿—è®°å½•åŠŸèƒ½

**æ—¥å¿—æ–‡ä»¶ä½ç½®ï¼š**
- æ‰€æœ‰æ—¥å¿—ä¿å­˜åœ¨ `test-logs/` ç›®å½•
- æ¯æ¬¡è¿è¡Œç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„æ—¥å¿—æ–‡ä»¶ï¼š
  - `test-run-YYYYMMDD-HHMMSS.log` - å®Œæ•´æµ‹è¯•è¾“å‡º
  - `test-errors-YYYYMMDD-HHMMSS.log` - é”™è¯¯è¯¦æƒ…
  - `test-summary-YYYYMMDD-HHMMSS.txt` - æµ‹è¯•æ‘˜è¦

**æ—¥å¿—å†…å®¹åŒ…æ‹¬ï¼š**
- âœ… æµ‹è¯•å¼€å§‹/ç»“æŸæ—¶é—´
- âœ… æ¯ä¸ªæµ‹è¯•çš„é€šè¿‡/å¤±è´¥çŠ¶æ€
- âœ… å¤±è´¥çš„æµ‹è¯•åç§°å’Œé”™è¯¯ä¿¡æ¯
- âœ… æµ‹è¯•ç»Ÿè®¡ï¼ˆæ€»æ•°ã€é€šè¿‡ã€å¤±è´¥ã€è·³è¿‡ï¼‰
- âœ… æ€»è€—æ—¶
- âœ… é”™è¯¯å †æ ˆå’Œè¯¦ç»†ä¿¡æ¯

### 4. æµ‹è¯•ç”¨ä¾‹éå†å’Œæ›´æ–°

**å·²æ£€æŸ¥çš„æµ‹è¯•æ–‡ä»¶ï¼š**
- âœ… `integrationTests.test.ts` - é›†æˆæµ‹è¯•
- âœ… `roundRegression.test.ts` - è½®æ¬¡å›å½’æµ‹è¯•
- âœ… `comprehensiveUnitTests.test.ts` - ç»¼åˆå•å…ƒæµ‹è¯•
- âœ… `comprehensiveRegressionTests.test.ts` - ç»¼åˆå›å½’æµ‹è¯•
- âœ… æ‰€æœ‰å…¶ä»–æµ‹è¯•æ–‡ä»¶ï¼ˆè¶…æ—¶è®¾ç½®å·²é€šè¿‡ vitest.config.ts ç»Ÿä¸€ç®¡ç†ï¼‰

**æ›´æ–°åŸåˆ™ï¼š**
1. æµ‹è¯•è¶…æ—¶æ—¶é—´ç»Ÿä¸€ä¸º 5 ç§’
2. Mock è¶…æ—¶æ—¶é—´ç»Ÿä¸€ä¸º 5 ç§’
3. æ¨¡æ‹Ÿå»¶è¿Ÿï¼ˆsetTimeoutï¼‰ä¿æŒä¸å˜ï¼ˆè¿™äº›æ˜¯ä¸šåŠ¡é€»è¾‘æ¨¡æ‹Ÿï¼Œä¸æ˜¯è¶…æ—¶ï¼‰
4. æ‰€æœ‰å¼‚æ­¥æ“ä½œéƒ½æœ‰æ˜ç¡®çš„è¶…æ—¶å¤„ç†

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

### æµ‹è¯•æ–‡ä»¶åˆ†ç±»

**æ ¸å¿ƒé€»è¾‘æµ‹è¯•ï¼š**
- å•å…ƒæµ‹è¯•ï¼š`comprehensiveUnitTests.test.ts`
- å›å½’æµ‹è¯•ï¼š`comprehensiveRegressionTests.test.ts`
- é›†æˆæµ‹è¯•ï¼š`integrationTests.test.ts`

**åŠŸèƒ½æµ‹è¯•ï¼š**
- æ¸¸æˆé€»è¾‘ï¼š`gameLogic.test.ts`
- å‘ç‰Œç®—æ³•ï¼š`dealingAlgorithms.test.ts`
- è®¡åˆ†æœåŠ¡ï¼š`scoringService.test.ts`
- èŠå¤©ç³»ç»Ÿï¼š`chatService.test.ts`, `chatSystem.test.ts`

**UI æµ‹è¯•ï¼š**
- å‘ç‰ŒåŠ¨ç”»ï¼š`dealingAnimation.test.ts`
- èŠå¤©æ°”æ³¡ï¼š`useChatBubbles.test.ts`
- æ‰‹ç‰Œç»„ä»¶ï¼š`compactHandCards.test.tsx`

**å¼‚æ­¥æµ‹è¯•ï¼š**
- è¯­éŸ³é›†æˆï¼š`speechIntegration.test.ts`
- ä¸²è¡Œæ’­æ”¾ï¼š`serialVoicePlayback.test.ts`
- å¤šè¯­è¨€ï¼š`i18n.test.ts`

**æ…¢æµ‹è¯•ï¼ˆMCTS ç›¸å…³ï¼‰ï¼š**
- `mctsTuning.test.ts`
- `mctsTrainingRegression.test.ts`
- `runQuickTuning.test.ts` (30-40åˆ†é’Ÿï¼Œéœ€è·³è¿‡)

## ğŸš€ è¿è¡Œæµ‹è¯•

### å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èæ—¥å¸¸ä½¿ç”¨ï¼‰
```bash
npm run test:fast
```

### å®Œæ•´æµ‹è¯•ï¼ˆåŒ…æ‹¬æ‰€æœ‰æµ‹è¯•ï¼‰
```bash
npm run test:realtime
```

### å¸¦æ—¥å¿—è®°å½•çš„å®Œæ•´æµ‹è¯•ï¼ˆæ¨èç”¨äºé•¿æ—¶é—´è¿è¡Œï¼‰
```bash
npm run test:all-with-logging
```

### æŸ¥çœ‹æµ‹è¯•æ—¥å¿—
```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
ls -lt test-logs/ | head -5

# æŸ¥çœ‹æœ€æ–°æ‘˜è¦
cat test-logs/test-summary-*.txt | tail -1

# æŸ¥çœ‹æœ€æ–°é”™è¯¯
cat test-logs/test-errors-*.log | tail -50
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è¶…æ—¶æ—¶é—´è®¾ç½®ï¼š**
   - å…¨å±€è¶…æ—¶ï¼š5ç§’ï¼ˆvitest.config.tsï¼‰
   - æµ‹è¯•ç”¨ä¾‹è¶…æ—¶ï¼š5ç§’
   - Mock è¶…æ—¶ï¼š5ç§’
   - å¦‚æœæµ‹è¯•éœ€è¦æ›´é•¿æ—¶é—´ï¼Œè¯·åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­æ˜ç¡®è®¾ç½®æ›´é•¿çš„è¶…æ—¶

2. **é•¿æ—¶é—´è¿è¡Œçš„æµ‹è¯•ï¼š**
   - ä½¿ç”¨ `npm run test:all-with-logging` è¿è¡Œå®Œæ•´æµ‹è¯•
   - æ—¥å¿—ä¼šè‡ªåŠ¨ä¿å­˜ï¼Œå¯ä»¥éšæ—¶æŸ¥çœ‹
   - å³ä½¿é‡åˆ°é”™è¯¯ä¹Ÿä¼šç»§ç»­è¿è¡Œï¼Œæœ€åæŸ¥çœ‹æ—¥å¿—å³å¯

3. **é”™è¯¯æ’æŸ¥ï¼š**
   - æŸ¥çœ‹ `test-logs/test-errors-*.log` è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
   - æŸ¥çœ‹ `test-logs/test-summary-*.txt` è·å–æµ‹è¯•æ‘˜è¦
   - æŸ¥çœ‹ `test-logs/test-run-*.log` è·å–å®Œæ•´æµ‹è¯•è¾“å‡º

4. **æ€§èƒ½ä¼˜åŒ–ï¼š**
   - ä½¿ç”¨ `test:fast` è·³è¿‡æ…¢æµ‹è¯•å’Œ UI/å¼‚æ­¥æµ‹è¯•
   - ä½¿ç”¨ `test:no-ui` è·³è¿‡ UI æµ‹è¯•
   - ä½¿ç”¨ `test:no-async` è·³è¿‡å¼‚æ­¥æµ‹è¯•
   - ä½¿ç”¨ `test:slow-only` åªè¿è¡Œæ…¢æµ‹è¯•

## ğŸ“ æ›´æ–°è®°å½•

- **2024-XX-XX**: åˆå§‹æ›´æ–°
  - ç»Ÿä¸€è¶…æ—¶æ—¶é—´ä¸º 5 ç§’
  - åˆ›å»ºæµ‹è¯•æ—¥å¿—è®°å½•è„šæœ¬
  - æ›´æ–°æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£

## ğŸ”— ç›¸å…³æ–‡æ¡£

- `TEST_CATEGORIES.md` - æµ‹è¯•åˆ†ç±»è¯´æ˜
- `TEST-SUMMARY.md` - æµ‹è¯•å¥—ä»¶æ€»ç»“
- `ASYNC_TIMEOUT_TESTING_GUIDE.md` - å¼‚æ­¥å’Œè¶…æ—¶æµ‹è¯•æŒ‡å—
- `BROKEN_TESTS.md` - å¤±è´¥çš„æµ‹è¯•åˆ—è¡¨

