# åœ¨ 192.168.0.13 ä¸Šå¯åŠ¨ MeLo TTS æœåŠ¡

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

### 1. ç¡®è®¤å½“å‰ä½ç½®

ä½ ç°åœ¨åœ¨ï¼š`~/melotts/MeloTTS` ç›®å½•ï¼ˆåœ¨ 192.168.0.13 æœåŠ¡å™¨ä¸Šï¼‰

### 2. æ£€æŸ¥ä¾èµ–

```bash
# æ£€æŸ¥ MeLo TTS æ˜¯å¦å·²å®‰è£…
python3 -c "from melo.api import TTS; print('âœ… MeLo TTS å·²å®‰è£…')"

# å¦‚æœæŠ¥é”™ï¼Œå®‰è£… MeLo TTS
pip install git+https://github.com/myshell-ai/MeloTTS.git

# å®‰è£… API æœåŠ¡å™¨ä¾èµ–
pip install fastapi uvicorn pydantic
```

## ğŸš€ å¯åŠ¨æ­¥éª¤

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨é¡¹ç›®æä¾›çš„è„šæœ¬ï¼ˆæ¨èï¼‰

#### ç¬¬ 1 æ­¥ï¼šå¤åˆ¶å¯åŠ¨è„šæœ¬åˆ° 0.13 æœåŠ¡å™¨

åœ¨ **192.168.0.13 æœåŠ¡å™¨**ä¸Šæ‰§è¡Œï¼š

```bash
# è¿›å…¥ä½ çš„ MeLo TTS ç›®å½•
cd ~/melotts/MeloTTS

# ä»æ¸¸æˆé¡¹ç›®å¤åˆ¶è„šæœ¬
cp /Ubuntu/home/jin/guozha_poker_game/start-melo-tts-server.py .

# æˆ–è€…ä½¿ç”¨ scp ä»å¦ä¸€å°æœºå™¨å¤åˆ¶
# scp /path/to/guozha_poker_game/start-melo-tts-server.py hlsystem@192.168.0.13:~/melotts/MeloTTS/
```

#### ç¬¬ 2 æ­¥ï¼šå¯åŠ¨æœåŠ¡

```bash
python3 start-melo-tts-server.py
```

ä½ ä¼šçœ‹åˆ°ï¼š

```
============================================================
ğŸ¤ MeLo TTS API æœåŠ¡å™¨
============================================================

ğŸ“¡ ç›‘å¬åœ°å€: http://0.0.0.0:7860
ğŸ  æœ¬åœ°è®¿é—®: http://localhost:7860
ğŸŒ ç½‘ç»œè®¿é—®: http://192.168.0.13:7860

ğŸ“š API æ–‡æ¡£: http://localhost:7860/docs
â¤ï¸  å¥åº·æ£€æŸ¥: http://localhost:7860/health

============================================================
æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨
============================================================

INFO:     Started server process
INFO:     Uvicorn running on http://0.0.0.0:7860
ğŸ”„ æ­£åœ¨åŠ è½½ MeLo TTS æ¨¡å‹...
âœ… MeLo TTS æ¨¡å‹åŠ è½½æˆåŠŸï¼
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨åˆ›å»ºè„šæœ¬

å¦‚æœæ— æ³•å¤åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ›å»ºï¼š

```bash
# åœ¨ ~/melotts/MeloTTS ç›®å½•ä¸‹
nano tts-server.py
```

ç²˜è´´ä»¥ä¸‹å†…å®¹ï¼š

```python
#!/usr/bin/env python3
from fastapi import FastAPI, HTTPException
from fastapi.responses import Response
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel
import uvicorn, logging, io

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

app = FastAPI()
app.add_middleware(CORSMiddleware, allow_origins=["*"], allow_methods=["*"], allow_headers=["*"])

_tts_model = None

def get_tts_model():
    global _tts_model
    if not _tts_model:
        from melo.api import TTS
        logger.info("åŠ è½½æ¨¡å‹...")
        _tts_model = TTS(language='ZH', device='auto')
        logger.info("âœ… æ¨¡å‹åŠ è½½å®Œæˆ")
    return _tts_model

class TTSRequest(BaseModel):
    text: str
    lang: str = "ZH"

@app.get("/health")
def health():
    get_tts_model()
    return {"status": "ok", "service": "Melo TTS"}

@app.post("/tts")
def tts(req: TTSRequest):
    if not req.text:
        raise HTTPException(400, "æ–‡æœ¬ä¸èƒ½ä¸ºç©º")
    
    model = get_tts_model()
    sid = model.hps.data.spk2id.get(req.lang, list(model.hps.data.spk2id.values())[0])
    
    logger.info(f"åˆæˆ: {req.text[:30]}...")
    
    out = io.BytesIO()
    model.tts_to_file(req.text, sid, out, format='wav', speed=1.0)
    
    logger.info(f"âœ… æˆåŠŸ")
    return Response(content=out.getvalue(), media_type="audio/wav")

if __name__ == "__main__":
    print("å¯åŠ¨ MeLo TTS æœåŠ¡å™¨: http://0.0.0.0:7860")
    uvicorn.run(app, host="0.0.0.0", port=7860)
```

ä¿å­˜ï¼ˆCtrl+X, Y, Enterï¼‰å¹¶å¯åŠ¨ï¼š

```bash
python3 tts-server.py
```

## âœ… æµ‹è¯•æœåŠ¡

### æµ‹è¯• 1ï¼šæœ¬åœ°å¥åº·æ£€æŸ¥

åœ¨ **0.13 æœåŠ¡å™¨**ä¸Šï¼Œæ‰“å¼€æ–°çš„ç»ˆç«¯çª—å£ï¼š

```bash
curl http://localhost:7860/health
```

åº”è¯¥è¿”å›ï¼š
```json
{"status":"ok","service":"Melo TTS"}
```

### æµ‹è¯• 2ï¼šæœ¬åœ° TTS åŠŸèƒ½

```bash
curl -X POST http://localhost:7860/tts \
  -H "Content-Type: application/json" \
  -d '{"text": "ä½ å¥½ä¸–ç•Œ", "lang": "ZH"}' \
  --output test.wav

# æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶
ls -lh test.wav
```

### æµ‹è¯• 3ï¼šä»å®¢æˆ·ç«¯æœºå™¨æµ‹è¯•

åœ¨ **APP å®¢æˆ·ç«¯æœºå™¨**ä¸Šï¼š

```bash
# å¥åº·æ£€æŸ¥
curl http://192.168.0.13:7860/health

# TTS æµ‹è¯•
curl -X POST http://192.168.0.13:7860/tts \
  -H "Content-Type: application/json" \
  -d '{"text": "è¿œç¨‹æµ‹è¯•", "lang": "ZH"}' \
  --output remote-test.wav
```

å¦‚æœå¤±è´¥ï¼Œæ£€æŸ¥é˜²ç«å¢™ï¼š

```bash
# Ubuntu/Debian
sudo ufw allow 7860/tcp
sudo ufw status

# CentOS/RHEL
sudo firewall-cmd --add-port=7860/tcp --permanent
sudo firewall-cmd --reload
```

## ğŸ”§ åå°è¿è¡Œï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ æƒ³è®©æœåŠ¡åœ¨åå°è¿è¡Œï¼Œå…³é—­ç»ˆç«¯åä»ç„¶è¿è¡Œï¼š

### æ–¹æ³• 1ï¼šä½¿ç”¨ nohup

```bash
nohup python3 start-melo-tts-server.py > tts.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f tts.log

# åœæ­¢æœåŠ¡
ps aux | grep start-melo-tts-server
kill <PID>
```

### æ–¹æ³• 2ï¼šä½¿ç”¨ screenï¼ˆæ¨èï¼‰

```bash
# åˆ›å»ºæ–°çš„ screen ä¼šè¯
screen -S melotts

# å¯åŠ¨æœåŠ¡
python3 start-melo-tts-server.py

# æŒ‰ Ctrl+A, ç„¶åæŒ‰ D åˆ†ç¦»ä¼šè¯ï¼ˆæœåŠ¡ç»§ç»­è¿è¡Œï¼‰

# é‡æ–°è¿æ¥æŸ¥çœ‹
screen -r melotts

# åˆ—å‡ºæ‰€æœ‰ä¼šè¯
screen -ls
```

### æ–¹æ³• 3ï¼šä½¿ç”¨ tmux

```bash
# åˆ›å»ºæ–°ä¼šè¯
tmux new -s melotts

# å¯åŠ¨æœåŠ¡
python3 start-melo-tts-server.py

# æŒ‰ Ctrl+B, ç„¶åæŒ‰ D åˆ†ç¦»

# é‡æ–°è¿æ¥
tmux attach -t melotts
```

## ğŸ“Š æŸ¥çœ‹æœåŠ¡çŠ¶æ€

### æŸ¥çœ‹è¿›ç¨‹

```bash
ps aux | grep python | grep tts
```

### æŸ¥çœ‹ç«¯å£

```bash
netstat -tlnp | grep 7860
# æˆ–
ss -tlnp | grep 7860
```

### æŸ¥çœ‹æ—¥å¿—

å¦‚æœä½¿ç”¨ nohupï¼š
```bash
tail -f tts.log
```

### è®¿é—® API æ–‡æ¡£

æµè§ˆå™¨æ‰“å¼€ï¼š`http://192.168.0.13:7860/docs`

## âŒ å¸¸è§é—®é¢˜

### Q1: ModuleNotFoundError: No module named 'melo'

```bash
pip install git+https://github.com/myshell-ai/MeloTTS.git
```

### Q2: ModuleNotFoundError: No module named 'fastapi'

```bash
pip install fastapi uvicorn pydantic
```

### Q3: ç«¯å£ 7860 å·²è¢«å ç”¨

```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :7860

# åœæ­¢è¯¥è¿›ç¨‹
kill <PID>

# æˆ–ä¿®æ”¹ç«¯å£ï¼ˆåœ¨è„šæœ¬æœ€åä¸€è¡Œï¼‰
uvicorn.run(app, host="0.0.0.0", port=8860)  # æ”¹ä¸º 8860
```

### Q4: å®¢æˆ·ç«¯æ— æ³•è¿æ¥

**æ£€æŸ¥æ¸…å•ï¼š**

1. æœåŠ¡å™¨æ˜¯å¦åœ¨è¿è¡Œï¼Ÿ
   ```bash
   curl http://localhost:7860/health
   ```

2. é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ï¼Ÿ
   ```bash
   sudo ufw status
   ```

3. ç½‘ç»œæ˜¯å¦è¿é€šï¼Ÿ
   ```bash
   ping 192.168.0.13
   ```

## âœ… éªŒè¯æ¸…å•

å¯åŠ¨æˆåŠŸçš„æ ‡å¿—ï¼š

- [ ] æœåŠ¡å™¨è¾“å‡ºæ˜¾ç¤º "âœ… MeLo TTS æ¨¡å‹åŠ è½½æˆåŠŸï¼"
- [ ] æœåŠ¡å™¨æ˜¾ç¤º "Uvicorn running on http://0.0.0.0:7860"
- [ ] æœ¬åœ°å¥åº·æ£€æŸ¥é€šè¿‡ï¼š`curl http://localhost:7860/health`
- [ ] æœ¬åœ° TTS æµ‹è¯•ç”Ÿæˆäº†éŸ³é¢‘æ–‡ä»¶
- [ ] è¿œç¨‹å¥åº·æ£€æŸ¥é€šè¿‡ï¼š`curl http://192.168.0.13:7860/health`

## ğŸ‰ æˆåŠŸï¼

æœåŠ¡å¯åŠ¨åï¼Œä½ ä¼šçœ‹åˆ°ï¼š

```
============================================================
ğŸ¤ MeLo TTS API æœåŠ¡å™¨
============================================================

ğŸ“¡ ç›‘å¬åœ°å€: http://0.0.0.0:7860
ğŸ  æœ¬åœ°è®¿é—®: http://localhost:7860
ğŸŒ ç½‘ç»œè®¿é—®: http://192.168.0.13:7860

============================================================

INFO:     Uvicorn running on http://0.0.0.0:7860
âœ… MeLo TTS æ¨¡å‹åŠ è½½æˆåŠŸï¼
```

## ğŸ“ ä¸‹ä¸€æ­¥

æœåŠ¡å¯åŠ¨æˆåŠŸåï¼Œé…ç½®æ¸¸æˆ APP è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨ï¼š

**å‚è€ƒæ–‡æ¡£**ï¼š`docs/setup/melo-tts-remote-connection.md`

**å¿«é€Ÿé…ç½®**ï¼šåœ¨ `src/App.tsx` ä¸­æ·»åŠ ï¼š

```typescript
meloConfig: {
  baseUrl: 'http://192.168.0.13:7860'
}
```

